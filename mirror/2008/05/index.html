<!DOCTYPE html>
<html dir='ltr'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/55013136-widget_css_bundle.css' rel='stylesheet' type='text/css'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='../../favicon.ico' rel='icon' type='image/x-icon'/>
<link href='index.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Factor: a practical stack language - Atom" href="http://factor-language.blogspot.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Factor: a practical stack language - RSS" href="http://factor-language.blogspot.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Factor: a practical stack language - Atom" href="https://www.blogger.com/feeds/17087850/posts/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<meta content='http://factor-language.blogspot.com/2008/05/' property='og:url'/>
<meta content='Factor: a practical stack language' property='og:title'/>
<meta content='&lt;a href=&quot;http://factorcode.org/slava&quot;&gt;Slava Pestov&lt;/a&gt;&#39;s weblog, primarily about &lt;a href=&quot;http://factorcode.org&quot;&gt;Factor&lt;/a&gt;.' property='og:description'/>
<title>Factor: a practical stack language: May 2008</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Stretch Denim Light
Designer: Darren Delaye
URL:      www.DarrenDelaye.com
Date:     11 Jul 2006
-----------------------------------------------
*/
body {
background: #ffffff;
margin: 0;
padding: 0px;
font: x-small Verdana, Arial;
text-align: center;
color: #333333;
font-size/* */:/**/small;
font-size: /**/small;
}
a:link {
color: #336699;
}
a:visited {
color: #336699;
}
a img {
border-width: 0;
}
#outer-wrapper {
font: normal normal 100% Verdana, Arial, Sans-serif;;
}
/* Header
----------------------------------------------- */
#header-wrapper {
margin:0;
padding: 0;
background-color: #c4e1ff;
text-align: left;
}
#header {
margin: 0 2%;
background-color: #c4e1ff;
color: #003366;
padding: 0;
font: normal normal 210% Verdana, Arial, Sans-serif;;
position: relative;
}
h1.title {
padding-top: 38px;
margin: 0 1% .1em;
line-height: 1.2em;
font-size: 100%;
}
h1.title a, h1.title a:visited {
color: #003366;
text-decoration: none;
}
#header .description {
display: block;
margin: 0 1%;
padding: 0 0 40px;
line-height: 1.4em;
font-size: 50%;
}
/* Content
----------------------------------------------- */
.clear {
clear: both;
}
#content-wrapper {
margin: 0 2%;
padding: 0 0 15px;
text-align: left;
background-color: #ffffff;
border: 1px solid #ffffff;
border-top: 0;
}
#main-wrapper {
margin-left: 1%;
width: 64%;
float: left;
background-color: #ffffff;
display: inline;       /* fix for doubling margin in IE */
word-wrap: break-word; /* fix for long text breaking sidebar float in IE */
overflow: hidden;      /* fix for long non-text content breaking IE sidebar float */
}
#sidebar-wrapper {
margin-right: 1%;
width: 29%;
float: right;
background-color: #ffffff;
display: inline;       /* fix for doubling margin in IE */
word-wrap: break-word; /* fix for long text breaking sidebar float in IE */
overflow: hidden;      /* fix for long non-text content breaking IE sidebar float */
}
/* Headings
----------------------------------------------- */
h2, h3 {
margin: 0;
}
/* Posts
----------------------------------------------- */
.date-header {
margin: 1.5em 0 0;
font-weight: normal;
color: #999999;
font-size: 100%;
}
.post {
margin: 0 0 1.5em;
padding-bottom: 1.5em;
}
.post-title {
margin: 0;
padding: 0;
font-size: 125%;
font-weight: bold;
line-height: 1.1em;
}
.post-title a, .post-title a:visited, .post-title strong {
text-decoration: none;
color: #333333;
font-weight: bold;
}
.post div {
margin: 0 0 .75em;
line-height: 1.3em;
}
.post-footer {
margin: -.25em 0 0;
color: #333333;
font-size: 87%;
}
.post-footer .span {
margin-right: .3em;
}
.post img, table.tr-caption-container {
padding: 4px;
border: 1px solid #ffffff;
}
.tr-caption-container img {
border: none;
padding: 0;
}
.post blockquote {
margin: 1em 20px;
}
.post blockquote p {
margin: .75em 0;
}
/* Comments
----------------------------------------------- */
#comments h4 {
margin: 1em 0;
color: #999999;
}
#comments h4 strong {
font-size: 110%;
}
#comments-block {
margin: 1em 0 1.5em;
line-height: 1.3em;
}
#comments-block dt {
margin: .5em 0;
}
#comments-block dd {
margin: .25em 0 0;
}
#comments-block dd.comment-footer {
margin: -.25em 0 2em;
line-height: 1.4em;
font-size: 78%;
}
#comments-block dd p {
margin: 0 0 .75em;
}
.deleted-comment {
font-style:italic;
color:gray;
}
.feed-links {
clear: both;
line-height: 2.5em;
}
#blog-pager-newer-link {
float: left;
}
#blog-pager-older-link {
float: right;
}
#blog-pager {
text-align: center;
}
/* Sidebar Content
----------------------------------------------- */
.sidebar h2 {
margin: 1.6em 0 .5em;
padding: 4px 5px;
background-color: #ffffff;
font-size: 100%;
color: #333333;
}
.sidebar ul {
margin: 0;
padding: 0;
list-style: none;
}
.sidebar li {
margin: 0;
padding-top: 0;
padding-right: 0;
padding-bottom: .5em;
padding-left: 15px;
text-indent: -15px;
line-height: 1.5em;
}
.sidebar {
color: #333333;
line-height:1.3em;
}
.sidebar .widget {
margin-bottom: 1em;
}
.sidebar .widget-content {
margin: 0 5px;
}
/* Profile
----------------------------------------------- */
.profile-img {
float: left;
margin-top: 0;
margin-right: 5px;
margin-bottom: 5px;
margin-left: 0;
padding: 4px;
border: 1px solid #ffffff;
}
.profile-data {
margin:0;
text-transform:uppercase;
letter-spacing:.1em;
font-weight: bold;
line-height: 1.6em;
font-size: 78%;
}
.profile-datablock {
margin:.5em 0 .5em;
}
.profile-textblock {
margin: 0.5em 0;
line-height: 1.6em;
}
/* Footer
----------------------------------------------- */
#footer {
clear: both;
text-align: center;
color: #333333;
}
#footer .widget {
margin:.5em;
padding-top: 20px;
font-size: 85%;
line-height: 1.5em;
text-align: left;
}
/** Page structure tweaks for layout editor wireframe */
body#layout #header {
width: 750px;
}

--></style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=17087850&amp;zx=107902e8-e226-40c6-bb3f-e93edf539d65' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=17087850&amp;zx=107902e8-e226-40c6-bb3f-e93edf539d65' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

</head>
<body>
<div class='navbar section' id='navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d17087850\x26blogName\x3dFactor:+a+practical+stack+language\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dBLUE\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttps://factor-language.blogspot.com/search\x26blogLocale\x3den_US\x26v\x3d2\x26homepageUrl\x3dhttp://factor-language.blogspot.com/\x26vt\x3d1910212838315471456',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div id='outer-wrapper'><div id='wrap2'>
<!-- skip links for text browsers -->
<span id='skiplinks' style='display:none;'>
<a href='index.html#main'>skip to main </a> |
      <a href='index.html#sidebar'>skip to sidebar</a>
</span>
<div id='header-wrapper'>
<div class='header section' id='header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='../../index.html'>
Factor: a practical stack language
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span><a href="http://factorcode.org/slava">Slava Pestov</a>'s weblog, primarily about <a href="http://factorcode.org">Factor</a>.</span></p>
</div>
</div>
</div></div>
</div>
<div id='content-wrapper'>
<div id='crosscol-wrapper' style='text-align:center'>
<div class='crosscol no-items section' id='crosscol'></div>
</div>
<div id='main-wrapper'>
<div class='main section' id='main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Saturday, May 24, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='1157675180676455591' itemprop='postId'/>
<a name='1157675180676455591'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='removing-duplicates-from-sequence.html'>Removing duplicates from a sequence</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-1157675180676455591' itemprop='description articleBody'>
<a href="http://groups.google.com/group/comp.lang.forth/browse_thread/thread/a101310d0e5a1a95#">Albert van der Horst posted to comp.lang.forth</a> about an "elementary but surprisingly difficult problem"; here's a snippet:<br /><br /><pre>An area giving as (addr_start, addr_end) contains items<br />of length ``len''. I want to get of the duplicates.<br /><br />Sorting the items is pretty easy, qsort can handle that.<br />Now eliminating the duplicates, we need only compare one<br />item to the next.<br />Something along compact (start, end, len -- end' )<br />The new end should be returned, of course.<br /><br />Even using variables/locals, I find this difficult.</pre><br /><br />The problem with Forth is that while it gives you all the building blocks needed to make high-level abstractions, it doesn't actually give you any pre-packaged ones and there's no culture of code sharing or library development in the Forth community either, so everybody has to reinvent basic sequence processing operations. In contrast, Factor's collection library makes this problem trivial.<br /><br />Suppose S is our sequence, already sorted. First of all, S[0] is always in the resulting sequence, R. For n > 1, the S[n] is in the result R only if S[n] != S[n-1]. Suppose we make a new sequence, T, such that T[n] is the pair (S[n],S[n+1]). Then we can get our R by removing all pairs from T such that both elements are equal, and then mapping over the result to take the second element form each pair, and finally prepending S[0] to this.<br /><br />Here is the Factor implementation:<br /><pre>[ 2 clump [ all-equal? not ] filter [ second ] map ] [ first ] bi prefix</pre><br />No variables, locals or stack shuffling needed.<br /><br />Here is how the code works:<br /><br /><code>2 clump</code> takes a sequence on the stack and gives a new sequence of '2 element clumps':<br /><br /><pre>( scratchpad ) { 1 2 2 3 4 4 4 5 6 } 2 clump .<br />{<br />    { 1 2 }<br />    { 2 2 }<br />    { 2 3 }<br />    { 3 4 }<br />    { 4 4 }<br />    { 4 4 }<br />    { 4 5 }<br />    { 5 6 }<br />}</pre><br />Next, <code>all-equal?</code> checks if all elements in an array are equal. We want to iterate over the above sequence of pairs, discarding those where both elements are equal; this is what <code>[ all-equal? not ] filter</code> achieves:<br /><pre>( scratchpad ) { 1 2 2 3 4 4 4 5 6 }<br />( scratchpad ) 2 clump [ all-equal? not ] filter .<br />{ { 1 2 } { 2 3 } { 3 4 } { 4 5 } { 5 6 } }</pre><br />Next, we want to take the second element of each pair, <code>[ second ] map</code>:<br /><pre>( scratchpad ) { 1 2 2 3 4 4 4 5 6 }<br />( scratchpad ) 2 clump [ all-equal? not ] filter [ second ] map .<br />{ 2 3 4 5 6 }</pre><br />Finally, we use <code>bi</code> because we do <i>two</i> things to the array; we first find the second element of each non-duplicate clump, then we take the first element of the original array:<br /><pre>( scratchpad ) { 1 2 2 3 4 4 4 5 6 }<br />( scratchpad ) [ 2 clump [ all-equal? not ] filter [ second ] map ] [ first ] bi . .<br />1<br />{ 2 3 4 5 6 }</pre><br />Now that we have two things on the stack, in the right order, we call <code>prefix</code> to add that element to the original array:<br /><pre>( scratchpad ) { 1 2 2 3 4 4 4 5 6 }<br />( scratchpad ) [ 2 clump [ all-equal? not ] filter [ second ] map ] [ first ] bi prefix .<br />{ 1 2 3 4 5 6 }</pre><br />Of course, this approach allocates some unnecessary intermediate structure. However, it took me about 20 seconds to write, and it worked the first time, I didn't have to mess around with variables, locals, or stack operations.<br /><br />It works with other data types also:<br /><pre>( scratchpad ) { "a man" "a man" "a plan" "a canal" "panama" "panama" }<br />( scratchpad ) [ 2 clump [ all-equal? not ] filter [ second ] map ] [ first ] bi prefix .<br />{ "a man" "a plan" "a canal" "panama" }</pre><br /><br /><b>Update:</b> Daniel Ehrenberg came up with an even shorter version; figuring it out is an exercise for the reader: <code>[ 2 clump [ = not ] assoc-filter values ] [ first ] bi prefix</code>.<br /><br />Now, removing duplicates is so common that Factor already has a word in the <code>sets</code> vocabulary named <code>prune</code> which does exactly this, but with a different algorithm:<br /><br />If you sort then iterate, you get an O(n log n) algorithm, and also it depends on there being an intrinsic order among the elements. Instead, you can use a hashtable; if you have good hashcodes, then in theory you get an <code>O(n)</code> algorithm (but the constant factors might be worse). The idea is that instead you iterate over your sequence, and check if each element is in the hashtable. If it's not there, it's a new element, and you flag it as such then add it to the hashtable. If it's already in the hashtable, you skip it.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/05/removing-duplicates-from-sequence.html' itemprop='url'/>
<a class='timestamp-link' href='removing-duplicates-from-sequence.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-05-24T16:46:00-04:00'>4:46 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=1157675180676455591' onclick=''>
3 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=1157675180676455591' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=1157675180676455591&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1157675180676455591&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1157675180676455591&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1157675180676455591&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1157675180676455591&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1157675180676455591&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Thursday, May 22, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='1999850991934162781' itemprop='postId'/>
<a name='1999850991934162781'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='ssltls-support-added.html'>SSL/TLS support added</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-1999850991934162781' itemprop='description articleBody'>
Some time last year, <a href="http://fun-factor.blogspot.com/">Elie Chaftari</a> implemented an OpenSSL binding</li> in Factor (and by the way, Elie, good luck with <a href="http://www.medioset.com/">Medioset</a>!). I took this binding and extended it into a high-level SSL library which integrates with Factor's streams and sockets. The effort involved was non-trivial, because OpenSSL's nonblocking I/O behavior is somewhat confusing and not very well documented. So far it only works on Unix. Integration with the Windows overlapped I/O system is still pending.<br />I will start by presenting a simple client/server application that uses standard sockets, then convert it to use SSL.<br />We will implement an application which sends the current time of day, formatted as an RFC822 string, to the user.<br />First of all, how do we print such a string? We get the current time with <code>now</code>, which pushes a timestamp object on the stack, then convert it to an RFC822 string with <code>timestamp>rfc822</code>:<br /><pre>( scratchpad ) USING: calendar calendar.format ;<br />( scratchpad ) now timestamp>rfc822 print<br />Thu, 22 May 2008 01:25:18 -0500</pre><br />We want to send this to every client that connects, so we use the <code>with-server</code> combinator from the <code>io.server</code> vocabulary. It takes four parameters:<br /><ul><li>A sequence of addresses to listen on. We create these addresses by passing a port number to the <code>internet-server</code> word. It gives us back a sequence of addresses:<br /><pre>( scratchpad ) 9670 internet-server .<br />{<br />    T{ inet6 f "0:0:0:0:0:0:0:0" 9670 }<br />    T{ inet4 f "0.0.0.0" 9670 }<br />}</pre></li><li>A service name for logging purposes. We pass <code>"daytime"</code>, which means that connections will be logged to the <code>logs/daytime/1.log</code> file in the Factor directory. We can then invoke <code>rotate-logs</code> to move <code>1.log</code> to <code>2.log</code>, and so on. Log analysis tools are available too. I've discussed this in a <a href="../02/new-logging-framework.html">prior blog post</a>.</li><li>Finally, a quotation which is run for each client connection, in a new thread. Our quotation just prints the current time:<br /><pre>[ now timestamp>rfc822 print ]</pre></li><li>An I/O encoding specifier for client connections. We only care about ASCII so we pass <code>ascii</code>.</li></ul><br />Here is a <code>daytime-server</code> word, with the complete <code>with-server</code> form:<br /><pre>USING: calendar.format calendar io.server io.encodings.ascii ;<br /><br />: daytime-server ( -- )<br />    9670 internet-server<br />    "daytime"<br />    ascii<br />    [ now timestamp>rfc822 print ]<br />    with-server ;</pre><br />We can start our server as follows:<br /><pre>USE: threads<br /><br />[ daytime-server ] in-thread</pre><br />Now, let's test it with <code>telnet</code>:<br /><pre>slava$ telnet localhost 9670<br />Trying ::1...<br />Connected to localhost.<br />Escape character is '^]'.<br />Thu, 22 May 2008 01:32:17 -0500<br />Connection closed by foreign host.</pre><br />Works fine. The log file <code>logs/daytime/1.log</code> will have now logged something like the following:<br /><pre>[2008-05-22T01:32:17-05:00] NOTICE accepted-connection: { T{ inet6 f "0:0:0:0:0:0:0:1" 50916 } }</pre><br />Now, let's write a client for this service. We'll write the client using the <code>with-client</code> combinator from <code>io.sockets</code>. It takes three parameters:<br /><ul><li>An address specifier. This is the server to connect to. We're going to connect to port 9670 on <code>localhost</code>, so we pass <code>"localhost" 9670 &lt;inet></code>.</li><li>An encoding specifier. Again, we're only interested in 7-bit ASCII, so we pass <code>ascii</code>.</li><li>The final parameter is a quotation. We wish to a line of input from the server and leave it on the stack, so we pass <code>[ readln ]</code>.</li></ul><br />Here is the complete <code>with-client</code> form:<br /><pre>USING: io io.sockets io.encodings.ascii ;<br /><br />"localhost" 9670 &lt;inet> ascii [ readln ] with-client</pre><br />We're not quite done though; we should really parse the timestamp from its RFC822 string representation back into a timestamp object. We can do this with the <code>rfc822>timestamp</code> word. Here is the complete <code>daytime-client</code> word, refactored to take a host name from the stack:<br /><pre>USING: calendar.format io io.sockets io.encodings.ascii ;<br /><br />: daytime-client ( hostname -- timestamp )<br />    9670 &lt;inet> ascii [ readln ] with-client<br />    rfc822>timestamp ;</pre><br />Let's test our program, using the <code>describe</code> word to get a verbose description of the timestamp returned:<br /><pre>( scratchpad ) "localhost" daytime-client describe<br />timestamp instance<br />"delegate"   f<br />"year"       2008<br />"month"      5<br />"day"        22<br />"hour"       1<br />"minute"     37<br />"second"     47<br />"gmt-offset" T{ duration f 0 0 0 -5 0 0 }</pre><br />So we're done! Here is the complete program:<br /><pre>USING: calendar.format calendar<br />io io.server io.sockets<br />io.encodings.ascii ;<br />IN: daytime<br /><br />: daytime-server ( -- )<br />    9670 internet-server<br />    "daytime"<br />    ascii<br />    [ now timestamp>rfc822 print ]<br />    with-server ;<br /><br />: start-daytime-server ( -- )<br />    [ daytime-server ] in-thread ;<br /><br />: daytime-client ( hostname -- timestamp )<br />    9670 &lt;inet> ascii [ readln ] with-client<br />    rfc822>timestamp ;</pre><br />You can put this in a file named <code>work/daytime/daytime.factor</code> in the Factor directory, then enter the following in the listener:<br /><pre>( scratchpad ) USE: daytime<br />Loading P" resource:work/daytime/daytime.factor"<br />( scratchpad ) start-daytime-server<br />( scratchpad ) "localhost" daytime-client describe</pre><br />So we have a simple client/server application with support for multiple connections and logging.<br /><br />Let's add SSL support! There are four things to change.<br /><ul><br /><li>We need to add <code>io.sockets.secure</code> to our <code>USING:</code> list:<br /><pre>USING: calendar.format calendar<br />io io.server io.sockets io.sockets.secure<br />io.encodings.ascii ;</pre><br /><li>We change <code>daytime-server</code> to accept SSL connections by replacing <code>internet-server</code> with <code>secure-server</code>; we also change the port number:<br /><pre>: daytime-server ( -- )<br />    9671 secure-server<br />    "daytime"<br />    ascii<br />    [ now timestamp>rfc822 print ]<br />    with-server ;</pre><br />The <code>secure-server</code> word is much like <code>internet-server</code> in that it takes a port number and outputs a list of addresses, except this time the addresses are <code>secure</code> addresses, which means that a server socket listening on one will accept SSL connections:<br /><pre>( scratchpad ) 9671 secure-server .<br />{<br />    T{ secure f T{ inet6 f "0:0:0:0:0:0:0:0" 9671 } }<br />    T{ secure f T{ inet4 f "0.0.0.0" 9671 } }<br />}</pre><br /></li><br /><li>Next, we change <code>start-daytime-server</code> to establish SSL configuration parameters. We need two things here, Diffie-Hellman key exchange parameters, and a certificate for the server.<br />Diffie-Hellman key exchange parameters can be generated with a command-line tool:<br /><pre>openssl dhparam -out dh1024.pem 1024</pre><br />There are several ways to go about obtaining a server certificate. You can either fork out some money to a CA such as <a href="http://verisign.com">VeriSign</a> or <a href="http://godaddy.com">GoDaddy</a> (prices range from $15 to $3000), or you can generate a self-signed certificate, for example <a href="http://sial.org/howto/openssl/self-signed/">by following these directions</a>. Once you have the two files, <code>dh1024.pem</code> and <code>server.pem</code>, place them inside <code>work/daytime/</code>, and modify <code>start-daytime-server</code> to wrap the <code>daytime-server</code> call with the <code>with-secure-context</code> combinator. This combinator takes a <code>secure-config</code> object from the stack, and we fill in the slots of this object with the pathnames of the two files we just generated:<br /><pre>: start-daytime-server ( -- )<br />    [<br />        &lt;secure-config><br />            "resource:work/daytime/dh1024.pem" >>dh-file<br />            "resource:work/daytime/server.pem" >>key-file<br />        [ daytime-server ] with-secure-context<br />    ] in-thread ;</pre><br />Note that you must nest <code>with-secure-context</code> inside <code>in-thread</code>, not vice versa, because <code>in-thread</code> returns immediately, and <code>with-secure-context</code> destroys the context after its quotation returns.<br /></li><br /><li>Finally, we change <code>daytime-client</code> to establish SSL connections. It suffices to change <code>&lt;inet></code> to <code>&lt;inet> &lt;secure></code>, and use the new port number we defined in <code>daytime-server</code>. This makes <code>with-client</code> establish an SSL connection:<br /><pre>: daytime-client ( hostname -- timestamp )<br />    9671 &lt;inet> &lt;secure> ascii [ readln ] with-client<br />    rfc822>timestamp ;</pre><br />However, by default, the client will validate the server's certificate, and unless you're using a certificate signed by a root CA, this will fail.<br />To disable verification, we can wrap client calls in an SSL configuration with verification disabled:<br /><pre>&lt;secure-config> f >>verify [ "localhost" daytime-client ] with-secure-context</pre><br /></li><br /></ul><br />Here is our complete daytime client/server vocabulary which uses SSL:<br /><pre>USING: calendar.format calendar<br />io io.server io.sockets io.sockets.secure<br />io.encodings.ascii ;<br />IN: daytime<br /><br />: daytime-server ( -- )<br />    9671 secure-server<br />    "daytime"<br />    ascii<br />    [ now timestamp>rfc822 print ]<br />    with-server ;<br /><br />: start-daytime-server ( -- )<br />    [<br />        &lt;secure-config><br />            "resource:work/daytime/dh1024.pem" >>dh-file<br />            "resource:work/daytime/server.pem" >>key-file<br />        [ daytime-server ] with-secure-context<br />    ] in-thread ;<br /><br />: daytime-client ( hostname -- timestamp )<br />    9671 &lt;inet> &lt;secure> ascii [ readln ] with-client<br />    rfc822>timestamp ;<br /><br />: daytime-client-no-verify ( hostname -- timestamp )<br />    #! Use this if your server has a self-signed certificate<br />    &lt;secure-config> f >>verify<br />    [ daytime-client ] with-secure-context ;</pre><br />That's it.<br />There is one more topic to cover, and that is mixed secure/insecure servers. Often you want to listen for insecure connections on one port, and secure connections on another. We can achieve this easily enough by concatenating the results of <code>internet-server</code> and <code>secure-server</code>:<br /><pre>( scratchpad ) 9670 internet-server 9671 secure-server append .<br />{<br />    T{ inet6 f "0:0:0:0:0:0:0:0" 9670 }<br />    T{ inet4 f "0.0.0.0" 9670 }<br />    T{ secure f T{ inet6 f "0:0:0:0:0:0:0:0" 9671 } }<br />    T{ secure f T{ inet4 f "0.0.0.0" 9671 } }<br />}</pre><br />The server will now listen on all four addresses, and the quotation can differentiate between insecure and secure clients by checking if the value of the <code>remote-address</code> variable is an instance of <code>secure</code> or not using the <code>secure?</code> word.<br />So what is missing? Several things:<br /><ul><li>As I've mentioned at the beginning, SSL sockets don't yet work on Windows. This will be addressed soon.</li><li>Session resumption is not supported, although this is relatively easy to implement; I just wanted to get everything else working first.</li><li>Client-side authentication isn't supported either. Again, this is pretty easy, and I'll address it soon.</li><li>While it is very easy to create client and server SSL sockets (just wrap your addresses with <code>&lt;secure></code>) there is currently no way to upgrade a socket that has already been opened to an SSL socket. This is needed for SMTP/TLS support. I haven't thought of a nice API for this, as soon as I do I will implement it.</li><li>Better control is needed over cypher suites and certificate validation.</li></ul>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/05/ssltls-support-added.html' itemprop='url'/>
<a class='timestamp-link' href='ssltls-support-added.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-05-22T02:20:00-04:00'>2:20 AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=1999850991934162781' onclick=''>
2 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=1999850991934162781' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=1999850991934162781&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1999850991934162781&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1999850991934162781&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1999850991934162781&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1999850991934162781&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1999850991934162781&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Tuesday, May 20, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='6854766318880591718' itemprop='postId'/>
<a name='6854766318880591718'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='whats-up-with-diggcom.html'>What's up with Digg.com?</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-6854766318880591718' itemprop='description articleBody'>
I was testing Factor's <code>http.client</code> library with <a href="http://digg.com">digg.com</a>, and I was just getting timeouts.<br /><br />Connecting with <code>telnet</code> now:<br /><pre>$ telnet digg.com 80<br />Trying 64.191.203.30...<br />Connected to digg.com.<br />Escape character is '^]'.<br />GET / HTTP/1.1<br />host: digg.com<br /><br />Connection closed by foreign host.<br /></pre><br />So <code>telnet</code> knows the connection is being dropped, but Factor doesn't detect this. I thought this might be a bug in Factor, but with all other sites I've tried, Factor correctly detects a closed connection, whereas with Digg, <code>read()</code> on the socket always returns -1 with <code>errno</code> set to <code>EAGAIN</code>. I'm not even sure how <code>telnet</code> detects the connection is being dropped.<br /><br />To make matters even more confusing, Java doesn't detect the socket was closed either; the following testcase hangs:<br /><pre>import java.net.*;<br />import java.io.*;<br /><br />public class DiggTest<br />{<br /> public static void main(String[] args) throws IOException<br /> {<br />  Socket s = new Socket("digg.com",80);<br /><br />  Writer w = new OutputStreamWriter(s.getOutputStream());<br />  Reader r = new InputStreamReader(s.getInputStream());<br /><br />  w.write("GET / HTTP/1.1\r\nHost: www.digg.com\r\n\r\n");<br />  w.flush();<br /><br />  int ch = r.read();<br /> }<br />}</pre><br />It turns out a TCP RESET packet is being sent, but for whatever reason, Factor and Java don't receive any notification of it, wheras telnet does.<br /><br />I'm completely stumped at this point. Anybody have an idea of what's going on?<br /><br /><b>Update:</b> As Jason points out in the comments, adding a User-Agent makes it work. I was aware of this already, but that's not the interesting part; what puzzles me is why Factor (and Java) don't pick up on the socket being closed.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/05/whats-up-with-diggcom.html' itemprop='url'/>
<a class='timestamp-link' href='whats-up-with-diggcom.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-05-20T17:27:00-04:00'>5:27 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=6854766318880591718' onclick=''>
2 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=6854766318880591718' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=6854766318880591718&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6854766318880591718&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6854766318880591718&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6854766318880591718&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6854766318880591718&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6854766318880591718&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Wednesday, May 14, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='523133846300265056' itemprop='postId'/>
<a name='523133846300265056'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='improved-destructors-merged-into-core.html'>Improved destructors merged into core; working on SSL binding</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-523133846300265056' itemprop='description articleBody'>
I don't have anything earth-shattering to blog about at this stage, so this post is mostly just a disorganized progress report for the last week or so.<br /><br />Last September, Doug Coleman implement a <a href="http://code-factor.blogspot.com/2007/09/destructors-in-factor.html">destructors abstraction for Factor</a>. At the start of this year, I implemented <a href="../01/generic-resource-disposal.html">a generic resource disposal protocol</a>. I combined these two concepts into a single vocabulary and moved it into the core.<br /><br />Over the last few months, destructors have proved their worth over and over again when dealing with C libraries. Doug's post above describes them in great detail.<br /><br />Here I will skim over the general concept, together with an overview of the new word names.<br /><br />Suppose you need to call a C function which takes an array of three structures. The array itself can be allocated in the Factor heap, as a byte array, however the structures must be allocated in the malloc heap because the garbage collector doesn't know about pointers inside byte arrays. So we can start by writing the following code:<br /><pre>FUNCTION: int our_c_function ( SHAPE* shapes ) ;<br /><br />"SHAPE" malloc-object<br />"SHAPE" malloc-object<br />"SHAPE" malloc-object<br />3array >c-void*-array<br />our_c_function 0 &lt; [ "Error return from C function" throw ] when</pre><br />This is useless because it leaks memory every time it is called.<br /><br />Let's keep the array around and deallocate them when we're done:<br /><pre>"SHAPE" malloc-object<br />"SHAPE" malloc-object<br />"SHAPE" malloc-object<br />3array [<br />    >c-void*-array our_c_function<br />    0 &lt; [ "Error return from C function" throw ] when<br />] keep<br />[ free ] each</pre><br />This is still problematic. Any one of the <code>malloc-object</code> calls can fail, and we're throwing an exception too. The solution is to use destructors:<br /><pre>[<br />    "SHAPE" malloc-object &amp;free<br />    "SHAPE" malloc-object &amp;free<br />    "SHAPE" malloc-object &amp;free<br />    3array >c-void*-array our_c_function<br />    0 &lt; [ "Error return from C function" throw ] when<br />] with-destructors</pre><br />The <code>&amp;free</code> word schedules an allocated block of memory for deallocation for when the <code>with-destructors</code> word returns, whether or not an error was thrown.<br /><br />The more general word is <code>&amp;dispose</code>, which can take any object implementing the generic resource disposal protocol. And this is where the destructors and disposal meet. The <code>with-disposal</code> combinator is now just a shorthand for <code>with-destructors</code>:<br /><pre>[ X ] with-disposal == [ &amp;dispose X ] with-destructors</pre><br />Recent language changes, such as destructors, the new slot accessors, inheritance, and the thread refactoring, have really cleaned up the Windows I/O code in particular. It used to be absolutely hideous with too much stack shuffling and repetition, but after my next set of patches are pushed out, it is pretty close to exemplary Win32 API usage -- and much cleaner than anything you'd write in C, which is a pretty good accomplishment I think, given that Win32 is designed around C. I will blog about the Windows I/O code as soon as I finish up with the next set of changes.<br /><br />What motivated moving destructors in the core is working on OpenSSL bindings. The OpenSSL API is pretty complex, especially so when doing non-blocking I/O, and I've had to overhaul the Unix I/O code to be able to plug it in. While overhauling the code I noticed a few places where my error handling logic was convoluted, and even a resource leak, so I used destructors to clean them up.<br /><br />I will blog about the new <code>io.sockets.secure</code> vocabulary when the OpenSSL binding is done. For now, I can show off OpenSSL checksums support. A few weeks ago I removed some duplication between our CRC32, MD5, SHA1 and SHA2 implementations by implementing a generic checksum protocol. Since then Doug also added an Adler32 implementation. The idea behind the protocol is that you have three words, <code>checksum-bytes</code>, <code>checksum-stream</code>, and <code>checksum-file</code>, each one taking some kind of object and a singleton representing the checksum algorithm. For example,<br /><pre>"factor.image" md5 checksum-file .<br />=> B{ 177 55 229 87 205 67 139 188 136 33 111 38 3 0 32 23 }</pre><br />However, if you try the Factor MD5 implementation you will notice it is rather slow. While it will become faster over time, OpenSSL already has a fast implementation. Thanks to the checksum protocol and some FFI fun, you can use it:<br /><pre>"factor.image" openssl-md5 checksum-file .<br />=> B{ 177 55 229 87 205 67 139 188 136 33 111 38 3 0 32 23 }</pre><br />There is also <code>openssl-sha1</code>. In fact any checksum supported by OpenSSL's <code>EVP_*</code> functions can be used, as follows:<br /><pre>"factor.image" "SHA256" &lt;openssl-checksum> checksum-file</pre><br />The code is in <code>checksums.openssl</code>.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/05/improved-destructors-merged-into-core.html' itemprop='url'/>
<a class='timestamp-link' href='improved-destructors-merged-into-core.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-05-14T23:01:00-04:00'>11:01 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=523133846300265056' onclick=''>
1 comment:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=523133846300265056' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=523133846300265056&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=523133846300265056&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=523133846300265056&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=523133846300265056&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=523133846300265056&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=523133846300265056&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Saturday, May 10, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='920780018387069076' itemprop='postId'/>
<a name='920780018387069076'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='garbage-collection-throughput.html'>Garbage collection throughput improvements</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-920780018387069076' itemprop='description articleBody'>
<h3>The problem</h3><br />About a month ago, I made some <a href="../04/gc-fixes-and-improvements.html">changes to the garbage collector</a>. These changes included drastically decreasing the default nursery size from 16mb to 1mb. This turned out to have a negative effect on performance, with GC consuming as much as 60% of run time on some tests.<br /><br />Instead of making the default nursery larger, which would just mask the problem until we hit workloads with 16 times as much allocation (or when the compiler began to generate code that was 16 times faster, or any combination of the above), I decided to investigate the root cause of the problem.<br /><br />Turns out that every minor GC was taking on the order of a few milliseconds at the minimum, which is too much time. Most of the time was spent scanning the cards array for marked cards. Even if there weren't any marked cards, with a 64mb heap and 64 byte card size, that's a million array entries to check.<br /><h3>Faster card scanning</h3><br />The first thing I did was change how the card scan loop operates. Instead of iterating over the array a byte at a time, and checking if each byte satisfies the card mark mask, we iterate over the array four bytes at a time, checking each group of four bytes against the mask. GCC should really be doing this optimization for me, because its a simple case of vectorization, but it doesn't, so I just wrote the code out by hand:<br /><pre>u32 *quad_ptr;<br />u32 quad_mask = mask | (mask &lt;&lt; 8) | (mask &lt;&lt; 16) | (mask &lt;&lt; 24);<br /><br />for(quad_ptr = (u32 *)first_card; quad_ptr &lt (u32 *)last_card; quad_ptr++)<br />{<br />        if(*quad_ptr & quad_mask)<br />        {<br />                F_CARD *ptr = (F_CARD *)quad_ptr;<br />                <br />                int card;<br />                for(card = 0; card &lt 4; card++)<br />                {<br />                        if(ptr[card] & mask)<br />                        {<br />                                collect_card(&ptr[card],gen,here);<br />                                ptr[card] &= ~unmask;<br />                        }<br />                }<br />        }<br />}</pre><br />This improved card scan performance by a factor of 3, which makes sense, because we do four times less loop iterations, but at some point, you still have to hit memory, which dampens things out a bit.<br /><br />This optimization improved performance, but not sufficiently so. I realized that card scanning hurt the most in benchmarks which didn't write into objects in the old generation at all; for example, a benchmark which operates on bignums, where the intermediate values are extremely short-lived, fills up the nursery very rapidly, and every minor GC checks all cards, which not only fills up the cache with junk, but doesn't achieve anything useful as no cards will be marked.<br /><br />On the other hard, a pointer recording approach where all stores are written into a buffer is also unacceptable, because in code with a high rate of mutation, you pay a hefty price every time the buffer overflows. So I had to find a compromise.<br /><h3>Introducing card decks</h3><br />My solution is something I haven't seen done anywhere else before, but it is pretty trivial if you think about it. It amounts to two-level card marking. We have an array of cards, where each card maps to a small amount of memory: 64 bytes in my case, but it could be anything; and an array of <i>card decks</i>. Each card deck corresponds to 1024 cards, and if a card is marked, then its deck must be marked too. This way, on a minor GC, we scan the deck array first, and then only check cards corresponding to marked decks.<br /><br />This complicates the write barrier, because now on every store we have to mark a card and a deck, not just a card as before. I decided to counterweight this by simplifying the write barrier in another way. Formerly, it would read the card, "or" it with a mask, and store it back. This was done because the card contained an additional piece of information, and that is the offset within the card where the first object begins. Cards have two mark bits, denoting a possible pointer from this generation to either aging space or the nursery, and the other six bits were reserved for the offset of the first object. By moving object offsets (I call them "allot markers") into a separate array, I removed a read operation from the write barrier; now it simply has to write the mark mask to the card, without caring about its existing contents. This also freed up two bits in the allot marker, allowing me to switch to 256 byte cards (and 256 kilobyte card decks).<br /><br />These improvements really helped on benchmarks which allocated large numbers of extremely short-lived objects, however on benchmarks which allocated longer-lived objects the improvements were still major but not so drastic. It turns out that if objects survives long enough to be copied from the nursery into aging space, then it is possible for this copying to begin to dominate running time.<br /><h3>Low-level optimizations</h3><br />The inner loop of the GC looked like so:<br /><pre>void copy_handle(CELL *handle)<br />{<br />        CELL pointer = *handle;<br /><br />        if(!immediate_p(pointer) && should_copy(pointer))<br />                *handle = copy_object(pointer);<br />}<br /><br />CELL collect_next(CELL scan)<br />{<br />        do_slots(scan,copy_handle);<br /><br />        if(collecting_gen == TENURED)<br />                do_code_slots(scan);<br /><br />        return scan + untagged_object_size(scan);<br />}</pre><br />This is very elegant code; <code>do_slots</code> is a higher-order function which applies a function pointer to each slot of the object. However, GCC doesn't try to optimize higher-order code at all, after all it is a C compiler not an ML compiler, and it isn't Sufficiently Smart Either! So I rewrote the above function by manually inlining <code>do_slots()</code> and replacing the function pointer invocation with the body of <code>copy_handle()</code>. The next thing I realized was that <code>should_copy()</code> contains a large series of conditional tests which did not depend on its input parameters, only global variables whose value was invariant for the duration of the collection:<br /><pre>/* test if the pointer is in generation being collected, or a younger one. */<br />INLINE bool should_copy(CELL untagged)<br />{<br />        if(in_zone(newspace,untagged))<br />                return false;<br />        if(collecting_gen == TENURED)<br />                return true;<br />        else if(HAVE_AGING_P && collecting_gen == AGING)<br />                return !in_zone(&data_heap->generations[TENURED],untagged);<br />        else if(HAVE_NURSERY_P && collecting_gen == NURSERY)<br />                return in_zone(&nursery,untagged);<br />        else<br />        {<br />                critical_error("Bug in should_copy",untagged);<br />                return false;<br />        }<br />}</pre><br />So again, I did a bit of hand-optimization. If <code>foo()</code> does not depend on the loop variable or the side effects of the body, then the following are equivalent:<br /><pre>while(A)<br />{<br />        if(foo()) B else C;<br />}<br /><br />if(foo)<br />{<br />        while(A) B;<br />}<br />else<br />{<br />        while(A) C;<br />}</pre><br />In the optimizing compiler literature, this is known as <i>loop unswitching</i>.<br /><br />The new <code>collect_next()</code> is much longer, but also much faster. It looks like this:<br /><pre>CELL collect_next(CELL scan)<br />{<br />        CELL *obj = (CELL *)scan;<br />        CELL *end = (CELL *)(scan + binary_payload_start(scan));<br /><br />        obj++;<br /><br />        CELL newspace_start = newspace->start;<br />        CELL newspace_end = newspace->end;<br /><br />        if(HAVE_NURSERY_P && collecting_gen == NURSERY)<br />        {<br />                CELL nursery_start = nursery.start;<br />                CELL nursery_end = nursery.end;<br /><br />                for(; obj &lt; end; obj++)<br />                {<br />                        CELL pointer = *obj;<br /><br />                        if(!immediate_p(pointer)<br />                                && (pointer >= nursery_start && pointer &lt; nursery_end))<br />                                *obj = copy_object(pointer);<br />                }<br />        }<br />        else if(HAVE_AGING_P && collecting_gen == AGING)<br />        {<br />                F_ZONE *tenured = &data_heap->generations[TENURED];<br /><br />                CELL tenured_start = tenured->start;<br />                CELL tenured_end = tenured->end;<br /><br />                for(; obj &lt; end; obj++)<br />                {<br />                        CELL pointer = *obj;<br /><br />                        if(!immediate_p(pointer)<br />                                && !(pointer >= newspace_start && pointer &lt; newspace_end)<br />                                && !(pointer >= tenured_start && pointer &lt; tenured_end))<br />                                *obj = copy_object(pointer);<br />                }<br />        }<br />        else if(collecting_gen == TENURED)<br />        {<br />                for(; obj &lt; end; obj++)<br />                {<br />                        CELL pointer = *obj;<br /><br />                        if(!immediate_p(pointer)<br />                                && !(pointer >= newspace_start && pointer &lt; newspace_end))<br />                                *obj = copy_object(pointer);<br />                }<br /><br />                do_code_slots(scan);<br />        }<br />        else<br />                critical_error("Bug in collect_next",0);<br /><br />        return scan + untagged_object_size(scan);<br />}</pre><br />That's a hell of a code explosion, but it made a real difference to the performance of the garbage collector.<br /><h3>Benchmarks</h3><br />The first benchmark just allocates 3-element arrays in a loop:<br /><pre>: garbage 1 2 3 3array ;<br /><br />: garbage-loop 150000000 [ garbage drop ] times ;<br /><br />[ garbage-loop ] time</pre><br />Here are the results with different nursery sizes; all times are in milliseconds and I ran each benchmark multiple times to ensure I was getting reliable results:<br /><table> <tr><td></td><th>Before</th><th>After</th></tr> <tr><th>1mb nursery:</th><td>8908</td><td>4461</td></tr> <tr><th>2mb nursery:</th><td>6455</td><td>4451</td></tr> <tr><th>4mb nursery:</th><td>5336</td><td>4582</td></tr> <tr><th>8mb nursery:</th><td>4779</td><td>4582</td></tr> </table><br />The second benchmark allocates larger arrays in a loop:<br /><pre>: garbage 100 f &lt;array> ;<br /><br />: garbage-loop 15000000 [ garbage drop ] times ;<br /><br />[ garbage-loop ] time</pre><br />The results are similar:<br /><table> <tr><td></td><th>Before</th><th>After</th></tr> <tr><th>1mb nursery:</th><td>10418</td><td>2158</td></tr> <tr><th>2mb nursery:</th><td>6364 </td><td>2178</td></tr> <tr><th>4mb nursery:</th><td>4966 </td><td>3223</td></tr> <tr><th>8mb nursery:</th><td>4249 </td><td>3294</td></tr> </table><br />An interesting phenomenon occurs where after the GC changes, a larger nursery actually begins to hurt performance. <a href="http://useless-factor.blogspot.com">Dan</a> and I hypothesized that this is due to the larger nursery hurting locality, with poor algorithms masking this effect with the older GC.<br /><br />The next benchmark allocates a lot of temporary arrays but stores them into larger arrays which are somewhat longer lived:<br /><pre>: garbage 100 f &lt;array> ;<br /><br />: garbage-loop 150 [ 10000 [ drop garbage ] map drop ] times ;<br /><br />[ garbage-loop ] time</pre><br />The size of the aging generation makes a difference here so I tried the benchmark with  more parameters:<br /><table> <tr><td></td><th>Before</th><th>After</th></tr> <tr><th>1mb nursery/2mb aging:</th><td>8693</td><td>5525</td></tr> <tr><th>2mb nursery/2mb aging:</th><td>7318</td><td>5255</td></tr> <tr><th>4mb nursery/2mb aging:</th><td>3939</td><td>2628</td></tr> <tr><th>8mb nursery/2mb aging:</th><td>2314</td><td>1526</td></tr> <tr><th>1mb nursery/8mb aging:</th><td>3455</td><td>1493</td></tr> <tr><th>4mb nursery/4mb aging:</th><td>3024</td><td>1894</td></tr> <tr><th>4mb nursery/4mb aging:</th><td>3157</td><td>1577</td></tr> <tr><th>8mb nursery/8mb aging:</th><td>1533</td><td>1003</td></tr> </table><br />The above benchmarks are somewhat unrealistic, however other benchmarks showed speedups too, some more drastic than others:<br /><table><th>Benchmark</th><th>Before</th><th>After</th></tr><tr><th>SHA1</th><td>12198</td><td>7282</td></tr><br /><tr><th>Random</th><td>18989</td><td>14459</td></tr><tr><th>Sort</th><td>15685</td><td>13476</td></tr><br /><tr><th>Raytracer</th><td>27700</td><td>12966</td></tr><tr><th>Mandelbrot</th><td>4633</td><td>1847</td></tr></table><br />Before the shrinking of the nursery, the runtimes of these benchmarks looked much like they do now; it was only until a month ago that GC time began to dominate benchmarks like that. However I like having a small nursery, and making it smaller forced me to optimize the garbage collector for higher throughput in constrained-memory conditions.<br /><h3>Looking ahead</h3><br />The next big change I will be making to the garbage collector is switching to using mark/sweep for the old generation. This will reduce memory consumption by almost 50%.<br /><br />The other side of this coin is compiler optimizations. If the compiler performed more advanced static analysis, it could eliminate much of the dynamic memory allocation in the above benchmarks, cutting GC time further. Of course, if we have a great compiler and a great GC, we'll just have great performance all around.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/05/garbage-collection-throughput.html' itemprop='url'/>
<a class='timestamp-link' href='garbage-collection-throughput.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-05-10T00:33:00-04:00'>12:33 AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=920780018387069076' onclick=''>
7 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=920780018387069076' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=920780018387069076&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=920780018387069076&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=920780018387069076&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=920780018387069076&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=920780018387069076&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=920780018387069076&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Monday, May 05, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='6664358190874771192' itemprop='postId'/>
<a name='6664358190874771192'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='io-changes-and-process-pipeline-support.html'>I/O changes, and process pipeline support</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-6664358190874771192' itemprop='description articleBody'>
I made some improvements to the I/O system today.<br /><h3>Default stream variables</h3><br />The <code>stdio</code> variable has been replaced by <code>input-stream</code> and <code>output-stream</code>, and there are four new words:<br /><ul><li><code>with-input-stream</code></li><li><code>with-output-stream</code></li><li><code>with-input-stream*</code></li><li><code>with-output-stream*</code></li></ul><br />The first two close the stream after, the latter do not. The <code>with-stream</code> and <code>with-stream*</code> words are still around, they expect a duplex stream, unpack it, and bind both variables.<br /><br />I've changed many usages of <code>with-stream</code> to use one of the unidirectional variants instead. This means that you can now write code like the following:<br /><pre>"foo.txt" utf8 [<br />    "blah.txt" utf8 [<br />        ... read from the first file, write to the second file,<br />        using read and write ...<br />    ] with-file-writer<br />] with-file-reader</pre><br />Before you had to use this really ugly "design pattern":<br /><pre>"foo.txt" utf8 &lt;file-reader> [<br />    "blah.txt" utf8 &lt;file-writer> [<br />        &lt;duplex-stream> [<br />            ...<br />        ] with-stream<br />    ] with-disposal<br />] with-disposal</pre><br />Speaking of duplex streams, because they're not used by anything in the core anymore I have moved them to extra. They are still used by <code>&lt;process-stream></code> and <code>&lt;client></code>. I added a <code>&lt;process-reader></code> and <code>&lt;process-writer></code> word for those cases where you only want a pipe in one direction; they express intention better.<br /><h3>Pipes</h3><br />The <code>&lt;process-stream></code> word has been around for a while, and this word used pipes internally, but they were not exposed in a nice, cross-platform way, until now.<br /><br />The <code>io.pipes</code> vocabulary contains two words:<br /><ul><li><code>&lt;pipe></code> creates a new pipe and wraps a pair of streams around it. The streams are packaged into a single duplex stream; any data written to the stream can be read back from the same stream (presumably, in a different thread). This is actually implemented with native pipes on Unix and Windows.</li><li>The <code>run-pipeline</code> word takes a sequence of quotations or launch descriptors, and runs them all in parallel with input wired up as if it were a Unix shell pipe. For example,<br /><pre>{ "cat foo.txt" "grep x" "sort" "uniq" } run-pipeline</pre><br />Corresponds to the following shell command:<br /><pre>cat foo.txt | grep x | sort | uniq</pre><br />In addition, being able to place process objects and quotations in the pipeline gives you a lot of expressive power.</li></ul><br /><h3>Appending process output to files</h3><br />The <code>io.launcher</code> vocabulary supports the full array of input and output redirection features, and now, pipelines. There was one missing component: redirecting process output to a file opened for appending. Now this is possible. The following Factor code:<br /><pre>&lt;process><br />    "do-stuff" >>command<br />    "log.txt" &lt;appender> >>stderr<br />run-process</pre><br />Corresponds to this shell command:<br /><pre>do-stuff 2>> do-stuff.txt</pre><br />Of course, shell script is a DSL for launching processes so it is more concise than Factor. However, Factor's <code>io.launcher</code> library now supports all of the features that the shell does, and its pretty easy to build a shell command parser using <a href="http://bluishcoder.co.nz">Chris Double's</a> PEG library, which translates shell commands to sequences of Factor process descriptors in a pipeline.<br /><br />And now, I present a concise illustration of the difference between the Unix philosophy and the Windows philosophy. Here we have two pieces of code, which do the exact same thing: create a new pipe, open both ends, return a pair of handles.<br /><br />Unix:<br /><pre>USING: system alien.c-types kernel unix math sequences<br />qualified io.unix.backend io.nonblocking ;<br />IN: io.unix.pipes<br />QUALIFIED: io.pipes<br /><br />M: unix io.pipes:(pipe) ( -- pair )<br />    2 "int" &lt;c-array><br />    dup pipe io-error<br />    2 c-int-array> first2<br />    [ [ init-handle ] bi@ ] [ io.pipes:pipe boa ] 2bi ;</pre><br /><br />Windows:<br /><pre>USING: alien alien.c-types arrays destructors io io.windows libc<br />windows.types math.bitfields windows.kernel32 windows namespaces<br />kernel sequences windows.errors assocs math.parser system random<br />combinators accessors io.pipes io.nonblocking ;<br />IN: io.windows.nt.pipes<br /><br />: create-named-pipe ( name -- handle )<br />    { PIPE_ACCESS_INBOUND FILE_FLAG_OVERLAPPED } flags<br />    PIPE_TYPE_BYTE<br />    1<br />    4096<br />    4096<br />    0<br />    security-attributes-inherit<br />    CreateNamedPipe<br />    dup win32-error=0/f<br />    dup add-completion<br />    f &lt;win32-file> ;<br /><br />: open-other-end ( name -- handle )<br />    GENERIC_WRITE<br />    { FILE_SHARE_READ FILE_SHARE_WRITE } flags<br />    security-attributes-inherit<br />    OPEN_EXISTING<br />    FILE_FLAG_OVERLAPPED<br />    f<br />    CreateFile<br />    dup win32-error=0/f<br />    dup add-completion<br />    f &lt;win32-file> ;<br /><br />: unique-pipe-name ( -- string )<br />    [<br />        "\\\\.\\pipe\\factor-" %<br />        pipe counter #<br />        "-" %<br />        32 random-bits #<br />        "-" %<br />        millis #<br />    ] "" make ;<br /><br />M: winnt (pipe) ( -- pipe )<br />    [<br />        unique-pipe-name<br />        [ create-named-pipe dup close-later ]<br />        [ open-other-end dup close-later ]<br />        bi pipe boa<br />    ] with-destructors ;</pre><br />The Windows API makes things difficult for no reason. Anonymous pipes do not support overlapped I/O, so you have to open a named pipe with a randomly-generated name (I'm not making this up, many other frameworks do the same thing and Microsoft even recommends this approach).<br /><br />On the flipside, the nice thing about supporting both Unix and Windows is that I get to come up with true high-level abstractions that make sense, instead of being able to get away with having thin wrappers over Unix system calls as so many other language implementations do. For example, Ocaml's idea of "high-level I/O" is some basic <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Unix.html">POSIX bindings</a>, together with incomplete emulation of Unix semantics on Windows. Look forward to writing a page of code if you want to map a file into memory or run a process and read its output into a string. And of course Java doesn't support pipes, I/O redirection for launching processes, or file system change monitoring, at all.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/05/io-changes-and-process-pipeline-support.html' itemprop='url'/>
<a class='timestamp-link' href='io-changes-and-process-pipeline-support.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-05-05T18:02:00-04:00'>6:02 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=6664358190874771192' onclick=''>
4 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=6664358190874771192' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=6664358190874771192&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6664358190874771192&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6664358190874771192&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6664358190874771192&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6664358190874771192&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6664358190874771192&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='http://factor-language.blogspot.com/search?updated-max=2008-06-29T02:09:00-04:00&amp;max-results=7&amp;reverse-paginate=true' id='Blog1_blog-pager-newer-link' title='Newer Posts'>Newer Posts</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='http://factor-language.blogspot.com/search?updated-max=2008-05-05T18:02:00-04:00&amp;max-results=7' id='Blog1_blog-pager-older-link' title='Older Posts'>Older Posts</a>
</span>
<a class='home-link' href='../../index.html'>Home</a>
</div>
<div class='clear'></div>
<div class='blog-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='http://factor-language.blogspot.com/feeds/posts/default' target='_blank' type='application/atom+xml'>Posts (Atom)</a>
</div>
</div>
</div></div>
</div>
<div id='sidebar-wrapper'>
<div class='sidebar section' id='sidebar'><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Older Posts</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/index.html'>
2010
</a>
<span class='post-count' dir='ltr'>(18)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/index.html'>
2009
</a>
<span class='post-count' dir='ltr'>(35)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='../index.html'>
2008
</a>
<span class='post-count' dir='ltr'>(96)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../06/index.html'>
June
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='index.html'>
May
</a>
<span class='post-count' dir='ltr'>(6)</span>
<ul class='posts'>
<li><a href='removing-duplicates-from-sequence.html'>Removing duplicates from a sequence</a></li>
<li><a href='ssltls-support-added.html'>SSL/TLS support added</a></li>
<li><a href='whats-up-with-diggcom.html'>What&#39;s up with Digg.com?</a></li>
<li><a href='improved-destructors-merged-into-core.html'>Improved destructors merged into core; working on ...</a></li>
<li><a href='garbage-collection-throughput.html'>Garbage collection throughput improvements</a></li>
<li><a href='io-changes-and-process-pipeline-support.html'>I/O changes, and process pipeline support</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(13)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(17)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/index.html'>
2007
</a>
<span class='post-count' dir='ltr'>(141)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(13)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(10)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(15)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(21)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/06/index.html'>
June
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(15)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/index.html'>
2006
</a>
<span class='post-count' dir='ltr'>(207)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(23)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(30)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(25)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(22)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(26)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(23)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/06/index.html'>
June
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(15)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/index.html'>
2005
</a>
<span class='post-count' dir='ltr'>(23)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class='clear'></div>
</div>
</div><div class='widget Feed' data-version='1' id='Feed2'>
<h2>Recent Factor Commits</h2>
<div class='widget-content' id='Feed2_feedItemListDisplay'>
<span style='filter: alpha(25); opacity: 0.25;'>
<a href='http://gitweb.factorcode.org/gitweb.cgi?p=factor.git;a=atom'>Loading...</a>
</span>
</div>
<div class='clear'></div>
</div><div class='widget Feed' data-version='1' id='Feed1'>
<h2>Planet Factor</h2>
<div class='widget-content' id='Feed1_feedItemListDisplay'>
<span style='filter: alpha(25); opacity: 0.25;'>
<a href='http://planet.factorcode.org/feed.xml'>Loading...</a>
</span>
</div>
<div class='clear'></div>
</div><div class='widget LinkList' data-version='1' id='LinkList1'>
<h2>Links</h2>
<div class='widget-content'>
<ul>
<li><a href='http://twitter.com/slava_pestov'>@slava_pestov</a></li>
<li><a href='http://factorcode.org/slava/'>My home page</a></li>
<li><a href='http://factorcode.org/'>Factor programming language</a></li>
<li><a href='http://concatenative.org/'>Concatenative language wiki</a></li>
<li><a href='http://planet.factorcode.org/'>Planet Factor</a></li>
</ul>
<div class='clear'></div>
</div>
</div></div>
</div>
<!-- spacer for skins that want sidebar and main to be the same height-->
<div class='clear'>&#160;</div>
</div>
<!-- end content-wrapper -->
<div id='footer-wrapper'>
<div class='footer no-items section' id='footer'></div>
</div>
</div></div>
<!-- end outer-wrapper -->

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/940443484-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY5o7oIyyx0SxKqzRAxfEj3W7JYcIA:1693932715072';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d17087850','//factor-language.blogspot.com/2008/05/','17087850');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '17087850', 'title': 'Factor: a practical stack language', 'url': 'http://factor-language.blogspot.com/2008/05/', 'canonicalUrl': 'http://factor-language.blogspot.com/2008/05/', 'homepageUrl': 'http://factor-language.blogspot.com/', 'searchUrl': 'http://factor-language.blogspot.com/search', 'canonicalHomepageUrl': 'http://factor-language.blogspot.com/', 'blogspotFaviconUrl': 'http://factor-language.blogspot.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en-US', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Factor: a practical stack language - Atom\x22 href\x3d\x22http://factor-language.blogspot.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Factor: a practical stack language - RSS\x22 href\x3d\x22http://factor-language.blogspot.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Factor: a practical stack language - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/17087850/posts/default\x22 /\x3e\n', 'meTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/591781cadcbb8744', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'archive', 'pageName': 'May 2008', 'pageTitle': 'Factor: a practical stack language: May 2008'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Factor: a practical stack language', 'description': '\x3ca href\x3d\x22http://factorcode.org/slava\x22\x3eSlava Pestov\x3c/a\x3e\x27s weblog, primarily about \x3ca href\x3d\x22http://factorcode.org\x22\x3eFactor\x3c/a\x3e.', 'url': 'http://factor-language.blogspot.com/2008/05/', 'type': 'feed', 'isSingleItem': false, 'isMultipleItems': true, 'isError': false, 'isPage': false, 'isPost': false, 'isHomepage': false, 'isArchive': true, 'isLabelSearch': false, 'archive': {'year': 2008, 'month': 5, 'rangeMessage': 'Showing posts from May, 2008'}}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/1333563935-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/3268905543-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_FeedView', new _WidgetInfo('Feed2', 'sidebar', document.getElementById('Feed2'), {'title': 'Recent Factor Commits', 'showItemDate': true, 'showItemAuthor': true, 'feedUrl': 'http://gitweb.factorcode.org/gitweb.cgi?p\x3dfactor.git;a\x3datom', 'numItemsShow': 5, 'loadingMsg': 'Loading...', 'openLinksInNewWindow': false, 'useFeedWidgetServ': 'true'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_FeedView', new _WidgetInfo('Feed1', 'sidebar', document.getElementById('Feed1'), {'title': 'Planet Factor', 'showItemDate': true, 'showItemAuthor': false, 'feedUrl': 'http://planet.factorcode.org/feed.xml', 'numItemsShow': 5, 'loadingMsg': 'Loading...', 'openLinksInNewWindow': false, 'useFeedWidgetServ': 'true'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LinkListView', new _WidgetInfo('LinkList1', 'sidebar', document.getElementById('LinkList1'), {}, 'displayModeFull'));
</script>
</body>
</html>