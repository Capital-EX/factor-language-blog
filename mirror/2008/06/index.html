<!DOCTYPE html>
<html dir='ltr'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/55013136-widget_css_bundle.css' rel='stylesheet' type='text/css'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='../../favicon.ico' rel='icon' type='image/x-icon'/>
<link href='index.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Factor: a practical stack language - Atom" href="http://factor-language.blogspot.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Factor: a practical stack language - RSS" href="http://factor-language.blogspot.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Factor: a practical stack language - Atom" href="https://www.blogger.com/feeds/17087850/posts/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<meta content='http://factor-language.blogspot.com/2008/06/' property='og:url'/>
<meta content='Factor: a practical stack language' property='og:title'/>
<meta content='&lt;a href=&quot;http://factorcode.org/slava&quot;&gt;Slava Pestov&lt;/a&gt;&#39;s weblog, primarily about &lt;a href=&quot;http://factorcode.org&quot;&gt;Factor&lt;/a&gt;.' property='og:description'/>
<title>Factor: a practical stack language: June 2008</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Stretch Denim Light
Designer: Darren Delaye
URL:      www.DarrenDelaye.com
Date:     11 Jul 2006
-----------------------------------------------
*/
body {
background: #ffffff;
margin: 0;
padding: 0px;
font: x-small Verdana, Arial;
text-align: center;
color: #333333;
font-size/* */:/**/small;
font-size: /**/small;
}
a:link {
color: #336699;
}
a:visited {
color: #336699;
}
a img {
border-width: 0;
}
#outer-wrapper {
font: normal normal 100% Verdana, Arial, Sans-serif;;
}
/* Header
----------------------------------------------- */
#header-wrapper {
margin:0;
padding: 0;
background-color: #c4e1ff;
text-align: left;
}
#header {
margin: 0 2%;
background-color: #c4e1ff;
color: #003366;
padding: 0;
font: normal normal 210% Verdana, Arial, Sans-serif;;
position: relative;
}
h1.title {
padding-top: 38px;
margin: 0 1% .1em;
line-height: 1.2em;
font-size: 100%;
}
h1.title a, h1.title a:visited {
color: #003366;
text-decoration: none;
}
#header .description {
display: block;
margin: 0 1%;
padding: 0 0 40px;
line-height: 1.4em;
font-size: 50%;
}
/* Content
----------------------------------------------- */
.clear {
clear: both;
}
#content-wrapper {
margin: 0 2%;
padding: 0 0 15px;
text-align: left;
background-color: #ffffff;
border: 1px solid #ffffff;
border-top: 0;
}
#main-wrapper {
margin-left: 1%;
width: 64%;
float: left;
background-color: #ffffff;
display: inline;       /* fix for doubling margin in IE */
word-wrap: break-word; /* fix for long text breaking sidebar float in IE */
overflow: hidden;      /* fix for long non-text content breaking IE sidebar float */
}
#sidebar-wrapper {
margin-right: 1%;
width: 29%;
float: right;
background-color: #ffffff;
display: inline;       /* fix for doubling margin in IE */
word-wrap: break-word; /* fix for long text breaking sidebar float in IE */
overflow: hidden;      /* fix for long non-text content breaking IE sidebar float */
}
/* Headings
----------------------------------------------- */
h2, h3 {
margin: 0;
}
/* Posts
----------------------------------------------- */
.date-header {
margin: 1.5em 0 0;
font-weight: normal;
color: #999999;
font-size: 100%;
}
.post {
margin: 0 0 1.5em;
padding-bottom: 1.5em;
}
.post-title {
margin: 0;
padding: 0;
font-size: 125%;
font-weight: bold;
line-height: 1.1em;
}
.post-title a, .post-title a:visited, .post-title strong {
text-decoration: none;
color: #333333;
font-weight: bold;
}
.post div {
margin: 0 0 .75em;
line-height: 1.3em;
}
.post-footer {
margin: -.25em 0 0;
color: #333333;
font-size: 87%;
}
.post-footer .span {
margin-right: .3em;
}
.post img, table.tr-caption-container {
padding: 4px;
border: 1px solid #ffffff;
}
.tr-caption-container img {
border: none;
padding: 0;
}
.post blockquote {
margin: 1em 20px;
}
.post blockquote p {
margin: .75em 0;
}
/* Comments
----------------------------------------------- */
#comments h4 {
margin: 1em 0;
color: #999999;
}
#comments h4 strong {
font-size: 110%;
}
#comments-block {
margin: 1em 0 1.5em;
line-height: 1.3em;
}
#comments-block dt {
margin: .5em 0;
}
#comments-block dd {
margin: .25em 0 0;
}
#comments-block dd.comment-footer {
margin: -.25em 0 2em;
line-height: 1.4em;
font-size: 78%;
}
#comments-block dd p {
margin: 0 0 .75em;
}
.deleted-comment {
font-style:italic;
color:gray;
}
.feed-links {
clear: both;
line-height: 2.5em;
}
#blog-pager-newer-link {
float: left;
}
#blog-pager-older-link {
float: right;
}
#blog-pager {
text-align: center;
}
/* Sidebar Content
----------------------------------------------- */
.sidebar h2 {
margin: 1.6em 0 .5em;
padding: 4px 5px;
background-color: #ffffff;
font-size: 100%;
color: #333333;
}
.sidebar ul {
margin: 0;
padding: 0;
list-style: none;
}
.sidebar li {
margin: 0;
padding-top: 0;
padding-right: 0;
padding-bottom: .5em;
padding-left: 15px;
text-indent: -15px;
line-height: 1.5em;
}
.sidebar {
color: #333333;
line-height:1.3em;
}
.sidebar .widget {
margin-bottom: 1em;
}
.sidebar .widget-content {
margin: 0 5px;
}
/* Profile
----------------------------------------------- */
.profile-img {
float: left;
margin-top: 0;
margin-right: 5px;
margin-bottom: 5px;
margin-left: 0;
padding: 4px;
border: 1px solid #ffffff;
}
.profile-data {
margin:0;
text-transform:uppercase;
letter-spacing:.1em;
font-weight: bold;
line-height: 1.6em;
font-size: 78%;
}
.profile-datablock {
margin:.5em 0 .5em;
}
.profile-textblock {
margin: 0.5em 0;
line-height: 1.6em;
}
/* Footer
----------------------------------------------- */
#footer {
clear: both;
text-align: center;
color: #333333;
}
#footer .widget {
margin:.5em;
padding-top: 20px;
font-size: 85%;
line-height: 1.5em;
text-align: left;
}
/** Page structure tweaks for layout editor wireframe */
body#layout #header {
width: 750px;
}

--></style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=17087850&amp;zx=107902e8-e226-40c6-bb3f-e93edf539d65' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=17087850&amp;zx=107902e8-e226-40c6-bb3f-e93edf539d65' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

</head>
<body>
<div class='navbar section' id='navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d17087850\x26blogName\x3dFactor:+a+practical+stack+language\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dBLUE\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttps://factor-language.blogspot.com/search\x26blogLocale\x3den_US\x26v\x3d2\x26homepageUrl\x3dhttp://factor-language.blogspot.com/\x26vt\x3d1910212838315471456',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div id='outer-wrapper'><div id='wrap2'>
<!-- skip links for text browsers -->
<span id='skiplinks' style='display:none;'>
<a href='index.html#main'>skip to main </a> |
      <a href='index.html#sidebar'>skip to sidebar</a>
</span>
<div id='header-wrapper'>
<div class='header section' id='header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='../../index.html'>
Factor: a practical stack language
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span><a href="http://factorcode.org/slava">Slava Pestov</a>'s weblog, primarily about <a href="http://factorcode.org">Factor</a>.</span></p>
</div>
</div>
</div></div>
</div>
<div id='content-wrapper'>
<div id='crosscol-wrapper' style='text-align:center'>
<div class='crosscol no-items section' id='crosscol'></div>
</div>
<div id='main-wrapper'>
<div class='main section' id='main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Monday, June 30, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='7104630111931775654' itemprop='postId'/>
<a name='7104630111931775654'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='interesting-use-case-for-spread.html'>An interesting use-case for the spread combinator</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-7104630111931775654' itemprop='description articleBody'>
The <code>spread</code> combinator is the least frequently used of any of the <a href="../03/inheritance-tuple-reshaping-cleavers.html">cleave family</a>.<br /><br />Recall that it takes a sequence of quotations, and applies the nth quotation to the nth stack element. So for example,<br /><pre>1 2 3 4 { [ 1 + ] [ 1 - ] [ 2 / ] [ 2 * ] } spread</pre><br />Leaves us with the following stack:<br /><pre>2 1 1+1/2 8</pre><br />It is easy to see why it is not used frequently; very rarely do we have 4 items on the stack, and then decide to manipulate each one individually. The <code>bi*</code> and <code>tri*</code> combinators special-case <code>spread</code> for 2 or 3 stack items, respectively; <code>bi*</code> is used pretty often, <code>tri*</code> not so much.<br /><br />However, it turns out <code>cleave</code> is very useful when meta-programming. Consider this code from the FFI implementation:<br /><pre>: (param-prep-quot) ( parameters -- )<br />    dup empty? [<br />        drop<br />    ] [<br />        unclip c-type c-type-unboxer-quot %<br />        \ >r , (param-prep-quot) \ r> ,<br />    ] if ;<br /><br />: param-prep-quot ( node -- quot )<br />    parameters>> [ &lt;reversed> (param-prep-quot) ] [ ] make ;</pre><br />We traverse a sequence recursively, stopping if it is empty, otherwise we use <code>unclip</code> to break it down into the first element and the of the sequence. We surround the result of the recursive call in a <code>>r</code>/<code>r></code> pair.<br /><br />Given something like <code>{ "float" "int" "char*" }</code>, this generates code like the following:<br /><pre>utf8 string>alien >r >r >float r> r></pre><br />This code was written before <code>spread</code>, and I just discovered that it is a perfect use-case for it:<br /><pre>: (param-prep-quot) ( parameters -- )<br />    c-type c-type-unboxer-quot ;<br /><br />: param-prep-quot ( node -- quot )<br />    parameters>> [ (param-prep-quot) ] map [ spread ] curry ;</pre><br />Much more elegant.<br /><br />This pattern came up in the FFI twice, and I refactored both usages. It also came up in something I'm working on; type declarations for tuple slots. I will blog in detail when this is done, but the basic idea is that you can assert that a tuple slot has a certain type when declaring the tuple class. Storing into the slot will check the type at runtime; the compiler will elide these checks when necessary, and make assumptions about the slot value's type when the slot is read. The <code>boa</code> word, which makes a tuple and fills in the slots from the stack, needs to check that the values on the stack satisfy the type declartions. It does this using a similar technique to the above; mapping over a sequence to make an array of quotations, and then applies to to <code>spread</code>.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/interesting-use-case-for-spread.html' itemprop='url'/>
<a class='timestamp-link' href='interesting-use-case-for-spread.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-30T18:07:00-04:00'>6:07 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=7104630111931775654' onclick=''>
3 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=7104630111931775654' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=7104630111931775654&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=7104630111931775654&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=7104630111931775654&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=7104630111931775654&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=7104630111931775654&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=7104630111931775654&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Sunday, June 29, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='244224854186307530' itemprop='postId'/>
<a name='244224854186307530'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='cedrics-code-challenge.html'>Cedric's code challenge</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-244224854186307530' itemprop='description articleBody'>
Cedric Beust <a href="http://beust.com/weblog/archives/000491.html">posed a coding challenge</a>:<br /><blockquote><i><br />Here is an interesting coding challenge: write a counter function that counts from 1 to max but only returns numbers whose digits don't repeat.<br /><br />...<br />Also:<br /><ul><li>Display the biggest jump (in the sequences above, it's 4: 98 -> 102)</li><li>Display the total count of numbers</li><li>Give these two values for max=10000</li></ul></i></blockquote><br />In the comments section of his blog, you can find many solutions, some are long, some are short but have lovely punctuation soup like <code>!/(.).*\1/, 1..MAX;</code> (that's from the Perl solution).<br /><br />Here is a Factor version that is shorter than anything in the comments there:<br /><pre>USING: kernel math.parser math.ranges math.vectors sequences sets ;<br /><br />1 10000 [a,b] [ number>string all-unique? ] filter<br />[ ] [ length ] [ dup 0 prefix v- supremum ] tri</pre><br />It leaves three values on the stack (hence <code>tri</code>): a sequence of numbers with non-repeating digits, the length of this sequence, and the largest jump between any two numbers in the sequence.<br /><br />Of course one could claim that this is cheating, since I'm using a lot of library words here. Fair enough, but those library words in the library for a reason: they get used a hell of a lot.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/cedrics-code-challenge.html' itemprop='url'/>
<a class='timestamp-link' href='cedrics-code-challenge.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-29T02:09:00-04:00'>2:09 AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=244224854186307530' onclick=''>
2 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=244224854186307530' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=244224854186307530&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=244224854186307530&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=244224854186307530&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=244224854186307530&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=244224854186307530&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=244224854186307530&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Friday, June 27, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='457563996439569843' itemprop='postId'/>
<a name='457563996439569843'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='windows-handle-inheritance.html'>Windows handle inheritance</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-457563996439569843' itemprop='description articleBody'>
I was debugging the deploy tool yesterday. The problem was that after I changed the HTTP request/response parsers to use PEGs, the HTTP client stopped working in deployed applications. After fixing this, I added a regression test to ensure this won't be a problem in the future. The test passed on my Mac, I pushed my fixes, and moved on. However, soon I got a notification from the Windows build machine that the test failed on Windows.<br /><br />After some further investigation, I noticed that if I start the HTTP server, and then spawn the deployed binary from the command line, the test works, but if I spawn the deployed binary from within Factor using <code>run-process</code>, it would fail. So this was not even specific to deployment, or the HTTP code; it would happen any time the following series of events occurred:<br /><ul><li>Factor instance A starts a TCP/IP server socket on port 1234</li><li>Factor intsance A spawns a Factor instance B</li><li>Factor instance B attempts to connect to port 1234</li><li>It times out while establishing the connection</li></ul><br />I then realized that handle inheritance was the problem here. It turns out my understanding of handle inheritance was wrong, and <a href="http://support.microsoft.com/kb/q150523/">this article</a> set me straight. Turns out any handle you create is inheritance by default, so the Factor instance B was inheriting the server socket from A, so when B was attempting to connect to the server socket, it would hit the inherited copy, and not the copy in A which was actually being listened on.<br /><br />Refactoring the Windows I/O code to set all handles to be non-inheritable by default, and only setting the inheritance flag on handles that are passed to subprocesses for I/O redirection, fixed the problem.<br /><br />Just goes to show how important continuous integration is.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/windows-handle-inheritance.html' itemprop='url'/>
<a class='timestamp-link' href='windows-handle-inheritance.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-27T19:53:00-04:00'>7:53 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=457563996439569843' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=457563996439569843' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=457563996439569843&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=457563996439569843&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=457563996439569843&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=457563996439569843&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=457563996439569843&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=457563996439569843&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Wednesday, June 18, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='3127391033155377788' itemprop='postId'/>
<a name='3127391033155377788'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='https-support-in-httpserver-some-notes.html'>HTTPS support in http.server, some notes on HTTP request/response parsing</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-3127391033155377788' itemprop='description articleBody'>
<h2>Generic servers in Factor</h2><br />The <code>io.servers.connection</code> vocabulary supersedes the <code>io.server</code> vocabulary, adding support for a connection count limit, SSL, and more configuration flags.<br /><br />The best way to explain how it works is with an example:<br /><pre>USING: accessors io io.servers.connection ;<br /><br />&lt;threaded-server><br />    "hello-world" >>name<br />    100 >>max-connections<br />    1080 >>insecure<br />    1090 >>secure<br />    &lt;secure-config><br />        "cert/server.pem" >>key-file<br />    >>secure-config<br />    [ "Hello, world." print ] >>handler<br />start-server</pre><br />This is a server which sends "Hello, world." to the client, then closes the connection. It accepts standard TCP/IP connections on port 1080, and SSL connections on port 1090. For SSL, it identifies itself to the client with the certificate in <code>certs/server.pem</code>. We set a limit of 100 concurrent connections, and connections are logged to <code>resource:logs/hello-world/*.log</code>.<br /><br />Here is another example:<br /><pre>USING: accessors io io.servers.connection io.launcher ;<br /><br />&lt;threaded-server><br />    "telnet" >>name<br />    10666 >>insecure<br />    [<br />        &lt;process><br />            "/bin/sh -i" >>command<br />            input-stream get >>stdin<br />            output-stream get >>stdout<br />            +stdout+ >>stderr<br />        run-process<br />    ] >>handler<br />start-server</pre><br />Please do not run this on a machine facing the Internet; it starts a server on port 10666 which spawns a bash shell, with I/O redirected to the client connection. This example won't work on Windows, or with SSL connections, because those types of streams cannot be stored in the <code>stdin</code> and <code>stdout</code> slots of a process tuple yet; however that will be fixed eventually, and then code such as the above might serve as a prototype of a Factor re-implementation of <a href="http://en.wikipedia.org/wiki/Inetd">inetd</a>.<br /><br />So that's <code>io.server.connections</code> for you: a lot of functionality wrapped up in a small package. Eduardo Cavazos is working on a DNS server in Factor right now, and at some point we're going to isolate some UDP/IP abstractions from his code which are not specific to DNS, and move those to <code>io.servers.packet</code>.<br /><h2>HTTPS support in http.server</h2><br />Using <code>io.servers.connection</code>, I implemented <code>https</code> support in the HTTP server. This was pretty easy, now that all the components are in place. The main changes I made were to the authentication system in the web framework. It now redirects you to the SSL port when a page requiring login is requested, however this can be disabled (although I would not encourage this).<br /><br />For web applications not using the authentication framework, there is another useful utility: any HTTP responder can be wrapped in a <code>&lt;secure-only</code> responder; this upgrades the connection SSL if a non-SSL request is made.<br /><br />To improve performance, I added session resumption support to <code>io.sockets.secure</code>, for both client and server connections; this can be disabled in the <code>&lt;secure-config></code> instance passed to <code>with-secure-context</code>. The SSL library still needs support for client authentication and it also needs to run on Windows; once those two items are done, it will pretty much be feature-complete. I might write bindings to the OpenSSL cyphers allowing them to be used stand-alone, too, however this is low-priority since I don't need that for anything right now.<br /><h2>Parsing HTTP requests and responses</h2><br />I also replaced the hand-coded code for parsing HTTP requests and responses with new code that uses Parser Expression Grammars (PEGs). While the new code was not a lot shorter, it does have a more declarative flavor, and is also more correct.<br /><br />During the course of this exercise, I learned how far modern web browsers deviate from the specifications, particularly in the area of cookies. Cookies are specified by a pair of RFCs, <a href="http://www.ietf.org/rfc/rfc2109.txt">RFC2109</a> and <a href="http://www.ietf.org/rfc/rfc2965.txt">RFC2965</a>, however the latter seems to be almost universally ignored, and browser and server developers seem to treat the former  as more of a set of ideas than a formal spec.<br /><br /><a href="http://www.mnot.net/blog/2006/10/27/cookie_fun">Mark Nottingham</a> blogged about this a little under two years ago, and seemingly, not much has changed since then. There is also <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=358320">this bug in Firefox</a>.<br /><br />After I mentioned these difficulties in the #concatenative IRC channel, <a href="http://zedshaw.com">Zed Shaw</a> joined the ensuing discussion and noted that <a href="http://paste.factorcode.org/responder/pastebin/show-paste?n=28">the RFCs themselves are quite vague</a> and seemingly contradict themselves.<br /><br />The general design of cookies makes it easy to expose vulnerabilities such as <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-3385">this one</a> in the Tomcat application server. I hope my code is secure but I will need to review it later in more detail to be sure.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/https-support-in-httpserver-some-notes.html' itemprop='url'/>
<a class='timestamp-link' href='https-support-in-httpserver-some-notes.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-18T01:58:00-04:00'>1:58 AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=3127391033155377788' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=3127391033155377788' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=3127391033155377788&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=3127391033155377788&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=3127391033155377788&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=3127391033155377788&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=3127391033155377788&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=3127391033155377788&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Saturday, June 14, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='2368716176366609025' itemprop='postId'/>
<a name='2368716176366609025'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='what-is-fluent-interface.html'>What is a fluent interface?</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-2368716176366609025' itemprop='description articleBody'>
I just saw <a href="http://code.google.com/p/jfluent/">this</a> on reddit, and I have no clue. Whatever a "fluent interface" is though, seems Factor doesn't need one, because their 21 line example can be written a million times more clearly in 4 lines of Factor:<br /><pre>USING: sequences strings math.ranges io ;<br />{ "i" "can" "has" "cheezburger" "plz" "?" } [ " " append ] map concat "\n" append<br />CHAR: A CHAR: Z [a,b] reverse [ CHAR: M > ] filter [ 1string ] map "," join<br />append print</pre>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/what-is-fluent-interface.html' itemprop='url'/>
<a class='timestamp-link' href='what-is-fluent-interface.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-14T05:32:00-04:00'>5:32 AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=2368716176366609025' onclick=''>
7 comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=2368716176366609025' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=2368716176366609025&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=2368716176366609025&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=2368716176366609025&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=2368716176366609025&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=2368716176366609025&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=2368716176366609025&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Tuesday, June 10, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='5512890104689765047' itemprop='postId'/>
<a name='5512890104689765047'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='dequeue-protocol-and-search-dequeues.html'>Dequeue protocol, and search dequeues</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-5512890104689765047' itemprop='description articleBody'>
While debugging the compiler and fixing some performance regressions yesterday, I ran into a situation where I needed a data structure with efficient insertion and removal at both ends, and constant-time membership testing.<br /><br />This is pretty easy to implement, by combining a double linked list with a hashtable, however I wanted this to have the same interface as a double linked list, so I made a new <code>dequeues</code> vocabulary which abstracts the operations on a double linked list, such as<br /><ul><li><code>push-front</code></li><li><code>push-back</code></li><li><code>pop-front</code></li><li><code>pop-back</code></li></ul><br />Double linked lists in the <code>dlists</code> vocabulary now implement this protocol instead of exposing dlist-specific operations.<br /><br />The dequeue protocol also has a <code>dequeue-member?</code> generic word. This word runs in linear time on dlists.<br /><br />Search dequeues in the <code>search-dequeues</code> wrap an assoc and a dequeue and provide a sub-linear implementation of <code>dequeue-member?</code> (constant time if the assoc is a hashtable). Pushing elements adds them to both the dequeue and assoc; the membership test is then just a call to <code>key?</code> on the assoc.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/dequeue-protocol-and-search-dequeues.html' itemprop='url'/>
<a class='timestamp-link' href='dequeue-protocol-and-search-dequeues.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-10T19:47:00-04:00'>7:47 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=5512890104689765047' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=5512890104689765047' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=5512890104689765047&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=5512890104689765047&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=5512890104689765047&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=5512890104689765047&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=5512890104689765047&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=5512890104689765047&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Saturday, June 07, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='1842374406703341478' itemprop='postId'/>
<a name='1842374406703341478'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='syntax-proposal-for-multi-methods.html'>Syntax proposal for multi-methods</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-1842374406703341478' itemprop='description articleBody'>
At the end of March, I outlined the <a href="../03/new-slot-accessors-merged.html">future direction for Factor</a>. In that list of major planned features, two are already done: inheritance and singletons. The new tuple syntax is relatively minor (except for updating existing code), so that leaves multi-methods. I really want to get multi-methods done by the end of June, or sometime in July perhaps, and then focus on the compiler, documentation, bug fixes, and libraries. I'm going to draw a line in the sand soon; no more language changes until 1.0.<br /><br />While I've implemented a rough draft of <a href="../04/multi-methods-and-hooks.html">multi-methods </a> already, I'm not happy with the syntax. When I revisit multi-methods, which I will soon, I will implement a radically different syntax that Eduardo and I came up with today.<br /><br />Code will have to be updated for multi-methods anyway; I didn't want to push out a lackluster syntax and have to change it later. I think now I've come up with a very good solution. There are still some minor details to work out, but I'm confident that they're solvable.<br /><br />First, a bit of background. Here is a word definition in Factor:<br /><pre>: v- ( seq n -- seq' ) [ - ] curry map ;</pre><br />Here is a generic word definition with the single-dispatch core generics:<br /><pre>GENERIC: present ( obj -- str )<br /><br />M: string present ;<br /><br />M: real present number>string ;<br /><br />M: word present word-name ;<br /><br />M: object present drop "an object" ;</pre><br />Here is the equivalent with <code>extra/multi-methods</code>:<br /><pre>USE: multi-methods<br /><br />GENERIC: present ( obj -- str )<br /><br />METHOD: present { string } ;<br /><br />METHOD: present { real } number>string ;<br /><br />METHOD: present { word ] word-name ;</pre><br />Here is the syntax we thought of and will most likely implement soon:<br /><pre>: present ( |string -- string ) ;<br /><br />: present ( |real -- string ) number>string ;<br /><br />: present ( |word -- string ) word-name ;</pre><br />Whoa! Those look like ordinary colon definitions! Well, here's the kicker. All words would be generic (and the distinct notion of a "generic word" won't exist; it will just be the default and only type of word). Indeed, any entries in the stack effect which contain <code>|</code> are specializers, with the text after <code>|</code> being the class name to specialize on.<br /><br />Right now, redefining the same word or method multiple times is an error. This won't change. The following will be invalid:<br /><pre>: write-content ( text -- ) ... ;<br /><br />: write-content ( text -- ) ... ;</pre><br />The following will be OK though:<br /><pre>: write-content ( text|string -- ) ... ;<br /><br />: write-content ( text|xml -- ) ... ;</pre><br />If you specify a method with no specializers, it is just the default method:<br /><pre>: write-content ( text -- ) ... ;</pre><br />And if you don't care to make a word generic, you just use <code>: ... ;</code> as before; a generic word with one default method behaves exactly like a normal word.<br /><br />All stack effects of methods will need to be 'congruent'; the following is not OK:<br /><pre>: combine ( s1|sequence s2|sequence -- result ) ... ;<br /><br />: combine ( s1|sequence s2|sequence s3|sequence -- result ) ... ;</pre><br />Now a big selling point of generic words is that you can put methods on generic words in other vocabularies; otherwise, they'd really be no different from pattern matching in ML. Right now, <code>:</code> always defines a word in the same vocabulary. But this will change, and you will be able to refer to qualified word names:<br /><pre>TUPLE: my-seq ... ;<br /><br />: sequences#length ( s|my-seq -- len ) ... ;<br /><br />: sequences#nth ( i|integer s|my-seq -- value ) ... ;</pre><br />Right now, we already have a <code>qualified</code> library for disambiguating the search path with explicit vocabulary names. You first explicitly request qualified access to a vocabulary,<br /><pre>USE: qualified<br />QUALIFIED: sequences</pre><br />Then proceed to refer to qualified names:<br /><pre>3 "hello world" sequences:nth</pre><br />Well, I don't like the use of <code>:</code> there; it was hastily thought out in my opinion (no offence, Dan :-) because it clashes with our usage of <code>:</code> as a word definition operator. So instead I propose <code>#</code>; it has precedent in HTML (anchors in URLs) and Ocaml (method references).<br /><br />Whereas with <code>:</code>, you will be able to define new words in the current vocabulary, and add methods to words in the current vocabulary, when referring to a word in another vocabulary you will only be allowed to refer to words that already exist. This is to catch mistakes like the following:<br /><pre>: seqences#lgenth ( i|integer s|my-seq -- value ) ... ;</pre><br />We don't want people to pollute existing vocabularies with their typos, and we want a parse-time error if a generic word in another vocabulary is renamed. Within the same vocabulary, you will be able to make a mistake like the following, which you cannot do right now:<br /><pre>: sheeple ( s|integer -- ) ... ;<br /><br />: shepele ( s|string -- ) ... ;</pre><br />Creating two words instead of one word with two methods. The parser won't be able to catch this mistake anymore, because whereas before <code>M:</code> would complain if the generic word didn't exist, <code>:</code> creates the word if necessary. However, if qualified word creation is prohibited, this potential problem is limited in scope to one vocabulary and good unit testing will catch it.<br /><br />Sometimes you want to define a generic word with no methods; the methods, and the concrete data types they specialize on, are defined in other vocabularies. Right now this is easy;<br /><pre>GENERIC: foo</pre><br />How would you do this in the new system you ask? Well, since we're merging <code>M:</code> with <code>:</code>, we should merge <code>GENERIC:</code> with its closest non-generic equivalent, which happens to be <code>DEFER:</code>. The <code>DEFER:</code> word basically means, "create a word with this name, so that I can refer to it, but don't give it a definition; I'll supply the definition later". <code>DEFER:</code> is rarely used right now, its mostly just useful for mutually recursive words, which don't come up often. If all words become generic, then <code>DEFER:</code> basically means "give me a generic word, but don't put any methods on it yet". Neat, huh?<br /><br />Another problem this solves is composable word definition types. Right now we have <code>:</code> for normal words, <code>GENERIC:</code> for generic words and <code>M:</code> for methods. In <code>extra/</code>, there is <code>::</code> for locals, <code>MEMO:</code> for memoized words, and <code>MACRO:</code> for macros. But what if you want a macro with named parameters and locals? Or a memoized generic? Well, <code>MACRO::</code> happens to exist, but not every combination is there, and in general there is a combinatorial explosion with the current system. We will still have <code>::</code>, but it will subsume the old <code>::</code> as well as <code>M::</code>. Furthermore, we won't need local variants of <code>MEMO:</code> and <code>MACRO:</code> at all. Instead, <code>MEMO: foo ( a b -- c )</code> will be like <code>DEFER:</code>; it will create a generic word with no methods, but with the additional perk that it memoizes on its inputs.<br /><br />This removes the double-up of defining words for variants with named parameters; we don't need <code>MEMO::</code>, <code>MACRO::</code>, <code>M::</code>, etc.<br /><br />So it ends up looking a bit more verbose. Current Factor:<br /><pre>MEMO: fib ( n -- result )<br />    dup 1 > [ [ 1 - fib ] [ 2 - fib ] bi + ] when ;</pre><br />Proposed definition syntax:<br /><pre>MEMO: fib ( n -- result )<br /><br />: fib ( n -- result )<br />    dup 1 > [ [ 1 - fib ] [ 2 - fib ] bi + ] when ;</pre><br />However, macros and memoized words don't come up that frequently, and this not only simplifies the existing implementation by removing defining words, it opens up new possibilities: generic macros, generic memoized words, a generic memoizing word where some methods use named parameters, etc. Cool stuff.<br /><br />There's a new idiom that this enables here, and that is a word which conceptually isn't generic (even though all words are, you don't actually want to override every word necessarily), it simply type checks its arguments. For example, right now I have a <code>create-method</code> word which does this:<br /><pre>TUPLE: check-method class generic ;<br /><br />: check-method ( class generic -- class generic )<br />    over class? over generic? and [<br />        \ check-method boa throw<br />    ] unless ; inline<br /><br />: &lt;method> ( class generic -- method )<br />    check-method<br />    [ method-word-props ] 2keep<br />    method-word-name f &lt;word><br />    [ set-word-props ] keep ;</pre><br />That's pretty disgusting. Here is the new style:<br /><pre>: &lt;method> ( |class |generic -- method )<br />    [ method-word-props ] 2keep<br />    method-word-name f &lt;word><br />    [ set-word-props ] keep ;</pre><br />Scrap the boilerplate!<br /><br />This formalizes a pattern that's been coming up frequently, and also allows the compiler to perform better optimizations.<br /><br />I also plan on allowing the type of the return values to be annotated. While this won't be used for dispatching (since its impossible unless you predict the future), the compiler will insert runtime checks to ensure that the returned values are indeed of the asserted type (optimizing them out if necessary). Furthermore, the compiler can assume the return type at call sites, which will enable further optimizations without inlining.<br /><br />Finally, parts of the documentation can be auto-generated. Here is the help for the <code>append</code> word:<br /><pre>HELP: append<br />{ $values { "seq1" sequence } { "seq2" sequence } { "newseq" sequence } }<br />{ $description "Outputs a new sequence of the same type as " { $snippet "seq1" }<br />" consisting of the elements of " { $snippet "seq1" } " followed by " { $snippet<br />"seq2" } "." }<br />{ $errors "Throws an error if " { $snippet "seq2" } " contains elements not<br />permitted in sequences of the same class as " { $snippet "seq1" } "." } ;</pre><br />If instead it were defined as<br /><pre>: append ( seq1|sequence seq2|sequence -- newseq|sequence )</pre><br />We wouldn't need the <code>$values</code> element in the help at all in this case at least.<br /><br />It would also make it easier to write generic code. You'd still have to think of good protocols to expose, and stuff like that; there's no silver bullet to make code automagically generic and reusable; but you'd pay less of a penalty for making code more flexible. Right now, the basic operations on sequences, such as <code>nth</code> and <code>length</code> are generic, but more complex ones, such as <code>push</code>, <code>append</code>, and so on, are not. This sucks if someone wants to implement a custom sequence type; a rope, for example; where <code>append</code> can be implemented more efficiently than the current implementation. While right now I could make <code>append</code> generic (along with all other sequence operations) in the future I won't need to. Instead you'll just be able to override any sequence operation, within reason. So this,<br /><pre>GENERIC: append ( seq1 seq2 -- newseq )<br /><br />M: object append ... default implementation ... ;</pre><br />Will collapse down to:<br /><pre>: append ( seq1 seq2 -- newseq ) ... default implementation ... ;</pre><br /><br />A final point to mention is hooks. Right now, core generics support a type of generic word known as a "hook". A hook is a generic word which dispatches on the value of a dynamically-scoped variable rather than a stack position. The <code>multi-methods</code> vocabulary generalizes this so that method definitions can be declared to dispatch on arbitrary variables. Well, when any word is able to be generic, you will be able to override any word with a new behavior that takes effect if a given variable has a certain type! This is insanely powerful and ripe for abuse, so the documentation will make it clear that this should only be done for words which are documented to have a contract that is compatible with hook overriding. In addition to being used where hooks are used now (I/O and UI backends, stuff like that) I believe this feature will be useful when unit testing code. If I'm working on a vocabulary, I don't need to explicitly make protocols for the sole purpose of mocking out some objects. I still need to write code in a style that's amenable to unit testing, but doing so becomes easier if the unit tests can specialize a word on a dynamic variable!<br /><br />As far as efficiency goes, I don't anticipate any slowdowns there. The two generic word systems we have now already optimize the case where you have a generic word with a sole method on <code>object</code>. So the following two definitions compile to the exact same machine code:<br /><pre>! Version 1<br />: foo ... ;<br /><br />! Version 2<br />GENERIC: foo<br /><br />M: object foo ... ;</pre><br />You only pay a price if you begin to specialize on different types. In addition, multiple dispatch will replace instances of hand-coded double dispatch; this will yield a performance boost. Finally, being able to declare input types on some words will not only be great for documentation purposes, it will allow the compiler's dispatch elimination machinery to kick it up a notch. Right now it only works within a single word, so the optimizer first has to inline a lot before it can pay off. This increases compile time. If it can optimize types across word boundaries, a whole new set of program analysis techniques are possible.<br /><br />Let's put this another way. The following parsing words will be eliminated:<br /><ul><li>M:</li><li>GENERIC:</li><li>MEMO::</li><li>MACRO::</li><li>M::</li><li>GENERIC#</li><li>HOOK:</li></ul><br />In return, you gain a huge amount of expressive power: multiple dispatch. Wow!<br /><br />My main priority right now is still the web framework. One the new wiki, pastebin and blog are in good shape I will blog about them in detail and deploy them on <code>factorcode.org</code>. After things settle down with the new web site, I will return to language work and implement the above!
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/syntax-proposal-for-multi-methods.html' itemprop='url'/>
<a class='timestamp-link' href='syntax-proposal-for-multi-methods.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-07T18:59:00-04:00'>6:59 PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=1842374406703341478' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=1842374406703341478' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=1842374406703341478&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1842374406703341478&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1842374406703341478&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1842374406703341478&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1842374406703341478&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=1842374406703341478&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='6185767382423344880' itemprop='postId'/>
<a name='6185767382423344880'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='cleave-combinators-and-url-objects.html'>Cleave combinators and URL objects</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-6185767382423344880' itemprop='description articleBody'>
<h2>Expressing intent with cleave combinators</h2><br />Even though the cleave combinators (<code>bi</code>, <code>tri</code>, <code>bi*</code>, <code>tri*</code>, and various others) are equivalent to a chain of keeps, eg,<br /><pre>[ A ] [ B ] [ C ] tri == [ A ] keep [ B ] keep C</pre><br />They shouldn't always be used as a substitute for <code>keep</code> and other forms of stack shuffling. This is because the cleave form expresses <i>intention</i>. In particular, they probably should not be used if the quotations take more than one input.<br /><br />For example, here is a piece of code in cairo.gadgets:<br /><pre>M: png-gadget render*<br />    path>> normalize-path cairo_image_surface_create_from_png<br />    [ cairo_image_surface_get_width ]<br />    [ cairo_image_surface_get_height 2array dup 2^-bounds ]<br />    [ [ copy-surface ] curry copy-cairo ] tri<br />    GL_BGRA render-bytes* ;</pre><br />I would instead write it as follows:<br /><pre>M: png-gadget render*<br />    path>> normalize-path cairo_image_surface_create_from_png<br />    [<br />        [ cairo_image_surface_get_width ]<br />        [ cairo_image_surface_get_height ]<br />        bi 2array dup 2^-bounds<br />    ]<br />    [ [ copy-surface ] curry ] bi<br />    GL_BGRA render-bytes* ;</pre><br />While this is a bit longer I think it is easier to understand.<br /><br />The reason I'm not interested in enforcing this with a type system, however, is because there are exceptions.<br /><br />One exception is when the quotations passed to the cleaver have a 'pipeline' effect <code>( obj val -- obj )</code>. Then I think it is pretty clear what is going on if you do this -- you're storing the same value into two slots:<br /><pre>[ >>a ] [ >> b ] bi</pre><br />or this -- you're storing three values into slots:<br /><pre>[ >>a ] [ >>b ] [ >>c ] tri*</pre><br />For example, suppose you have a word which take a string and parses it, outputting three values:<br /><pre>: parse-foo ( str -- a b c )</pre><br />And you want to write a constructor for a tuple type:<br /><pre>: &lt;bar> ( str d e -- bar )<br />    bar new<br />        swap >>e<br />        swap >>d<br />        swap parse-foo [ >>a ] [ >>b ] [ >>c ] tri* ;</pre><br />A concrete example is the URL parsing code in the <code>urls</code> vocabulary. Here are a couple of pretty long (but hopefully straightforward) definitions which demonstrate this idiom:<br /><pre>: parse-host-part ( url protocol rest -- url string' )<br />    [ >>protocol ] [<br />        "//" ?head [ "Invalid URL" throw ] unless<br />        "@" split1 [<br />            [ ":" split1 [ >>username ] [ >>password ] bi* ] dip<br />        ] when*<br />        "/" split1 [<br />            parse-host [ >>host ] [ >>port ] bi*<br />        ] [ "/" prepend ] bi*<br />    ] bi* ;<br /><br />M: string >url<br />    &lt;url> swap<br />    ":" split1 [ parse-host-part ] when*<br />    "#" split1 [<br />        "?" split1<br />        [ url-decode >>path ]<br />        [ [ query>assoc >>query ] when* ] bi*<br />    ]<br />    [ url-decode >>anchor ] bi* ;</pre><br /><h2>First-class URLs</h2><br />Which brings me to my next topic, URLs. I'm a big fan of using the most specific data types possible for everything: timestamps instead of integers with the implicit convention that they store milliseconds since an epoch, time durations instead of integers (distinct from timestamps), symbols instead of magic strings and numbers, specialized arrays where possible, and so on. I also think that path names, money and dimensioned units should be first-class, instead of strings and numbers, respectively; while we have libraries for those latter three they're not used as much as the former (a shame, really).<br /><br />While working on the routing and redirection part of Factor's web framework, I noticed a lot of boilerplate coming up that I couldn't easily abstract away. The natural solution seemed to be to promote URLs to a first-class data type instead of passing strings around.<br /><br />URLs are very easy to use. First you have literal URLs:<br /><pre>URL" http://www.apple.com"</pre><br />You can also construct them from strings at runtime:<br /><pre>"http://www.apple.com/foo.html#blah" >url</pre><br />Or you can construct them from components:<br /><pre>&lt;url><br />    "ftp" >>protocol<br />    "ftp.cdrom.com" >>host<br />    "/pub" >>path</pre><br />Setting query parameters is supported, and the URL code takes care of URL encoding and decoding for you:<br /><pre>( scratchpad ) URL" http://search.yahooapis.com/WebSearchService/V1/webSearch?query=Hello+World"<br />( scratchpad ) "query" query-param .<br />"Hello World"</pre><br />Likewise, you can set query parameters with <code>set-query-param</code>.<br /><br />URLs support two main operations: converting back to a string, and deriving a URL from a base URL and a relative URL.<br /><br />For converting URLs to a string, I decided to make a new generic word and put a method on that for URLs, instead of defining a word specific to URLs. The word is called <code>present</code> and it is in the <code>present</code> vocabulary. It has methods for the following types, so far:<br /><ul><li>strings</li><li>numbers</li><li>words</li><li>timestamps</li><li>URLs</li></ul><br />Unlike <code>unparse</code>, which converts an object into source code, <code>present</code> outputs a string which is more human-readable, and the process is possibly lossy. For example, strings present as themselves, and numbers present as their string representation. Timestamps present in RFC822 format.<br /><br />Deriving a URL from a base URL and a relative URL allows you to take a URL with some components possibly missing, and fill them in from a base URL. The web framework uses this to ensure that all HTTP redirects sent to the client are absolute.<br /><br />I refactored <a href="http://useless-factor.blogspot.com">Daniel Ehrenberg's</a> <a href="http://factorcode.org/responder/cgi/gitweb.cgi?p=factor.git;a=blob;f=extra/yahoo/yahoo.factor;h=c47b8be15c92340cef3b53be27ab99c050fe11bb;hb=2e39bed5ec45d0d10a658c60cfd6367a2895ee18">yahoo</a> library to use URL objects for constructing the search query. The code is really concise now; just build a URL, pass it to <code>http-get</code>, and parse the XML result to build an array of search result objects. Parsing the XML only takes 5 lines of code!<br /><br />Sometime soon, <a href="http://code-factor.blogspot.com">Doug Coleman</a> will update his FTP client library to use URL objects also, at which point we can define a protocol for reading and writing generic URLs, allowing code to be written which can deal with both FTP, HTTP, and HTTPS abstractly.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/cleave-combinators-and-url-objects.html' itemprop='url'/>
<a class='timestamp-link' href='cleave-combinators-and-url-objects.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-07T09:14:00-04:00'>9:14 AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=6185767382423344880' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=6185767382423344880' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=6185767382423344880&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6185767382423344880&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6185767382423344880&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6185767382423344880&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6185767382423344880&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=6185767382423344880&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Friday, June 06, 2008</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='17087850' itemprop='blogId'/>
<meta content='9004889986675446150' itemprop='postId'/>
<a name='9004889986675446150'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='persistent-vectors.html'>Persistent vectors</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-9004889986675446150' itemprop='description articleBody'>
I've been working on the new HTTP server and web framework for what seems like ages now. I used it to implement a new pastebin, a wiki (<code>webapps/wiki</code> in the repository), and today I started working on a blog server. However, all this relational database CRUD can get pretty monotonous, so I decided to work on something a little more fun: porting <a href="http://clojure.org">Clojure's</a> <a href="http://clojure.svn.sourceforge.net/viewvc/*checkout*/clojure/trunk/src/jvm/clojure/lang/PersistentVector.java?revision=877">PersistentVector</a> to Factor. <br /><br />We have implementations of AVL trees and splay trees in the library which look pretty ugly, however they date back several years before we had some nice abstractions and idioms worked out, and the code could definitely be revisited and improved. Recently Eric Mertens implemented <a href="http://factorcode.org/responder/cgi/gitweb.cgi?p=factor.git;a=blob;f=extra/disjoint-set/disjoint-set.factor;h=6f3b1e63e82c504ad8d556ba8224155a66e59705;hb=HEAD">disjoint-sets</a>; the code came out looking pretty nice, however though two words use locals. This got me interested in implementing data structures in Factor again.<br /><br />The Java version weighs in at 210 lines, and the Factor version is 184 lines, with a few more blank lines and shorter lines in general. It is in the git repository now, and you can <a href="http://factorcode.org/responder/cgi/gitweb.cgi?p=factor.git;a=blob;f=extra/persistent-vectors/persistent-vectors.factor;h=5e25be5dd33c38160a4a95f500a55e69386751ad;hb=32a95a79e42f74b3752d7e0dc50cb8f8e8da96bc">browse it online</a>.<br /><br />The code is pretty decent as far as Java code goes, however porting it to Factor presented two main challenges.<br /><br />Some of the recursive functions used in the implementation take a large number of parameters. While Factor supports locals, I wanted to write this code entirely using the stack, to see how suitable stack languages are for implementing complex data structures.<br /><br />I found that literal translations of the Java code looked pretty ugly, until I figured out a drastic simplification. The <code>shift</code> parameter, which is passed around in the Java code to store the current nesting level, can be stored in the tree node itself.<br /><br />Here is the Java code for getting the <code>i</code>th element of a vector:<br /><pre>public Object nth(int i){<br /> if(i >= 0 && i &lt; cnt)<br />  {<br />  if(i >= tailoff())<br />   return tail[i & 0x01f];<br />  Object[] arr = root;<br />  for(int level = shift; level > 0; level -= 5)<br />   arr = (Object[]) arr[(i >>> level) & 0x01f];<br />  return arr[i & 0x01f];<br />  }<br /> throw new IndexOutOfBoundsException();<br />}</pre><br />In Factor, it looks like this:<br /><pre>: node-size 32 ; inline<br /><br />: node-mask node-size mod ; inline<br /><br />: node-shift -5 * shift ; inline<br /><br />: node-nth ( i node -- obj )<br />    [ node-mask ] [ children>> ] bi* nth ; inline<br /><br />: body-nth ( i node -- i node' )<br />    dup level>> [<br />        dupd [ level>> node-shift ] keep node-nth<br />    ] times ; inline<br /><br />: tail-offset ( pvec -- n )<br />    [ count>> ] [ tail>> children>> length ] bi - ;<br /><br />M: persistent-vector nth-unsafe<br />    2dup tail-offset >=<br />    [ tail>> ] [ root>> body-nth ] if<br />    node-nth ;</pre><br />It is a bit longer because of the utility words at the top - I chose to abstract out the node size instead of hard-coding it at 32 - and because nodes are pairs here, a sequence of children and an integer level.<br /><br />The Java code also makes heavy use of early returns and out parameters. Factor supports early returns via continuations (recently, I added a <code>with-return</code> combinator and a <code>return</code> word to encapsulate this idiom) but I wanted to write the code in a functional style. And of course out parameters are possible too, but since we can just push two values on the stack before leaving a word, they make no sense. So I had to spend some time analyzing the code's control flow and thinking about how to express it in a more functional style.<br /><br />For example, consider this Java code from Clojure:<br /><pre>public PersistentVector cons(Object val){<br /> if(tail.length &lt; 32)<br />  {<br />  Object[] newTail = new Object[tail.length + 1];<br />  System.arraycopy(tail, 0, newTail, 0, tail.length);<br />  newTail[tail.length] = val;<br />  return new PersistentVector(meta(), cnt + 1, shift, root, newTail);<br />  }<br /> Box expansion = new Box(null);<br /> Object[] newroot = pushTail(shift - 5, root, tail, expansion);<br /> int newshift = shift;<br /> if(expansion.val != null)<br />  {<br />  newroot = new Object[]{newroot, expansion.val};<br />  newshift += 5;<br />  }<br /> return new PersistentVector(meta(), cnt + 1, newshift, newroot, new Object[]{val});<br />}<br /><br />private Object[] pushTail(int level, Object[] arr, Object[] tailNode, Box expansion){<br /> Object newchild;<br /> if(level == 0)<br />  {<br />  newchild = tailNode;<br />  }<br /> else<br />  {<br />  newchild = pushTail(level - 5, (Object[]) arr[arr.length - 1], tailNode, expansion);<br />  if(expansion.val == null)<br />   {<br />   Object[] ret = arr.clone();<br />   ret[arr.length - 1] = newchild;<br />   return ret;<br />   }<br />  else<br />   newchild = expansion.val;<br />  }<br /> //expansion<br /> if(arr.length == 32)<br />  {<br />  expansion.val = new Object[]{newchild};<br />  return arr;<br />  }<br /> Object[] ret = new Object[arr.length + 1];<br /> System.arraycopy(arr, 0, ret, 0, arr.length);<br /> ret[arr.length] = newchild;<br /> expansion.val = null;<br /> return ret;<br />}</pre><br />There are several early return statements in there, also an out parameter is used. Since the same <code>Box</code> instance is threaded through the recursion, a store into the box in an inner recursive call will propagate outwards. It took me a bit of thought to figure out the flow of data through this box.<br /><br />The Factor code for the above operation:<br /><pre>: node-add ( obj node -- node' )<br />    clone [ ppush ] change-children ;<br /><br />: ppush-tail ( obj pvec -- pvec' )<br />    [ node-add ] change-tail ;<br /><br />: full? ( node -- ? )<br />    children>> length node-size = ;<br /><br />: 1node ( obj level -- node )<br />    node new<br />        swap >>level<br />        swap 1array >>children ;<br /><br />: 2node ( first second -- node )<br />    [ 2array ] [ drop level>> 1+ ] 2bi node boa ;<br /><br />: new-child ( new-child node -- node' expansion/f )<br />    dup full? [ tuck level>> 1node ] [ node-add f ] if ;<br /><br />: new-last ( val seq -- seq' )<br />    [ length 1- ] keep new-nth ;<br /><br />: node-set-last ( child node -- node' )<br />    clone [ new-last ] change-children ;<br /><br />: (ppush-new-tail) ( tail node -- node' expansion/f )<br />    dup level>> 1 = [<br />        new-child<br />    ] [<br />        tuck children>> peek (ppush-new-tail)<br />        [ swap new-child ] [ swap node-set-last f ] ?if<br />    ] if ;<br /><br />: do-expansion ( pvec root expansion/f -- pvec )<br />    [ 2node ] when* >>root ;<br /><br />: ppush-new-tail ( obj pvec -- pvec' )<br />    [ ] [ tail>> ] [ root>> ] tri<br />    (ppush-new-tail) do-expansion<br />    swap 0 1node >>tail ;<br /><br />M: persistent-vector ppush ( obj pvec -- pvec' )<br />    clone<br />    dup tail>> full?<br />    [ ppush-new-tail ] [ ppush-tail ] if<br />    [ 1+ ] change-count ;</pre><br />Again, here we have to deal with the fact that nodes are (sequence,level) pairs and not simple sequences.<br /><br />One trick I'm using here is defining generic persistent sequence operations, <code>ppush</code> (like <code>push</code> but persistent), and <code>new-nth</code> (like <code>set-nth</code> but persistent). They are implemented naively on ordinary sequences, and the persistent vector implementation relies on the ordinary sequence implementation as the base case; when you <code>ppush</code> onto a persistent vector, eventually you end up <code>ppush</code>ing onto the sequence of children stored in some node; this sequence is just a Factor array.<br /><br />The Java code, which creates new constituents then constructs a new persistent vector at the end. This works well in Java. In Factor, I instead clone the persistent vector I am given (this is a shallow clone) and modify some of its slots. Same result, but simpler code because there are less values floating around.<br /><br />I have a Factor word which outputs an empty persistent vector:<br /><pre>: pempty ( -- pvec )<br />    T{ persistent-vector f 0 T{ node f { } 1 } T{ node f { } 0 } } ; inline</pre><br />Using this word and <code>ppush</code>, we can convert any Factor sequence into a persistent vector:<br /><pre>pempty [ swap ppush ] reduce</pre><br />We can then implement literal syntax for persistent vectors:<br /><pre>M: persistent-vector like<br />    drop pempty [ swap ppush ] reduce ;<br /><br />: >persistent-vector ( seq -- pvec ) pempty like ; inline<br /><br />: PV{ \ } [ >persistent-vector ] parse-literal ; parsing<br /><br />M: persistent-vector pprint-delims drop \ PV{ \ } ;<br /><br />M: persistent-vector >pprint-sequence ;</pre><br />Here is an example showing both reader syntax and prettyprinter output resulting from the above definitions:<br /><pre>( scratchpad ) PV{ "hello" "world" } ppop "Clojure" swap ppush .<br />PV{ "hello" "Clojure" }</pre><br />Implementing and playing around with persistent vectors was definitely fun and educational. Most of the time I work with very basic data structures -- arrays, hashtables -- and implementing something a bit more complex was a good Factor coding exercise. I think the code could be cleaned up with some more abstractions, better factoring and new idioms. The <a href="../03/inheritance-tuple-reshaping-cleavers.html">cleave combinators</a> we added recently definitely helped a lot here and without them the code would look a lot uglier than it does now. There is room for further improvement. I also plan on implementing Clojure's PersistentHashMaps and PersistentSortedMaps at some point to see what they look like in Factor.
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='http://factor-language.blogspot.com/2008/06/persistent-vectors.html' itemprop='url'/>
<a class='timestamp-link' href='persistent-vectors.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2008-06-06T03:02:00-04:00'>3:02 AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.blogger.com/comment.g?blogID=17087850&postID=9004889986675446150' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-action'>
<a href='https://www.blogger.com/email-post.g?blogID=17087850&postID=9004889986675446150' title='Email Post'>
<img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
</a>
</span>
<span class='item-control blog-admin pid-561774689'>
<a href='https://www.blogger.com/post-edit.g?blogID=17087850&postID=9004889986675446150&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=9004889986675446150&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=9004889986675446150&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=9004889986675446150&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=9004889986675446150&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=17087850&postID=9004889986675446150&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='http://factor-language.blogspot.com/search?updated-max=2008-08-24T02:29:00-04:00&amp;max-results=7&amp;reverse-paginate=true' id='Blog1_blog-pager-newer-link' title='Newer Posts'>Newer Posts</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='http://factor-language.blogspot.com/search?updated-max=2008-06-06T03:02:00-04:00&amp;max-results=7' id='Blog1_blog-pager-older-link' title='Older Posts'>Older Posts</a>
</span>
<a class='home-link' href='../../index.html'>Home</a>
</div>
<div class='clear'></div>
<div class='blog-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='http://factor-language.blogspot.com/feeds/posts/default' target='_blank' type='application/atom+xml'>Posts (Atom)</a>
</div>
</div>
</div></div>
</div>
<div id='sidebar-wrapper'>
<div class='sidebar section' id='sidebar'><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Older Posts</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/index.html'>
2010
</a>
<span class='post-count' dir='ltr'>(18)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2010/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/index.html'>
2009
</a>
<span class='post-count' dir='ltr'>(35)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2009/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='../index.html'>
2008
</a>
<span class='post-count' dir='ltr'>(96)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='index.html'>
June
</a>
<span class='post-count' dir='ltr'>(9)</span>
<ul class='posts'>
<li><a href='interesting-use-case-for-spread.html'>An interesting use-case for the spread combinator</a></li>
<li><a href='cedrics-code-challenge.html'>Cedric&#39;s code challenge</a></li>
<li><a href='windows-handle-inheritance.html'>Windows handle inheritance</a></li>
<li><a href='https-support-in-httpserver-some-notes.html'>HTTPS support in http.server, some notes on HTTP r...</a></li>
<li><a href='what-is-fluent-interface.html'>What is a fluent interface?</a></li>
<li><a href='dequeue-protocol-and-search-dequeues.html'>Dequeue protocol, and search dequeues</a></li>
<li><a href='syntax-proposal-for-multi-methods.html'>Syntax proposal for multi-methods</a></li>
<li><a href='cleave-combinators-and-url-objects.html'>Cleave combinators and URL objects</a></li>
<li><a href='persistent-vectors.html'>Persistent vectors</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(13)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(17)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/index.html'>
2007
</a>
<span class='post-count' dir='ltr'>(141)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(13)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(10)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(15)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(21)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/06/index.html'>
June
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(9)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2007/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(15)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/index.html'>
2006
</a>
<span class='post-count' dir='ltr'>(207)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(23)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(30)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(25)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(22)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/08/index.html'>
August
</a>
<span class='post-count' dir='ltr'>(26)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/07/index.html'>
July
</a>
<span class='post-count' dir='ltr'>(23)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/06/index.html'>
June
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/05/index.html'>
May
</a>
<span class='post-count' dir='ltr'>(15)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/04/index.html'>
April
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/03/index.html'>
March
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/02/index.html'>
February
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2006/01/index.html'>
January
</a>
<span class='post-count' dir='ltr'>(12)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/index.html'>
2005
</a>
<span class='post-count' dir='ltr'>(23)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/12/index.html'>
December
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/11/index.html'>
November
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/10/index.html'>
October
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='../../2005/09/index.html'>
September
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class='clear'></div>
</div>
</div><div class='widget Feed' data-version='1' id='Feed2'>
<h2>Recent Factor Commits</h2>
<div class='widget-content' id='Feed2_feedItemListDisplay'>
<span style='filter: alpha(25); opacity: 0.25;'>
<a href='http://gitweb.factorcode.org/gitweb.cgi?p=factor.git;a=atom'>Loading...</a>
</span>
</div>
<div class='clear'></div>
</div><div class='widget Feed' data-version='1' id='Feed1'>
<h2>Planet Factor</h2>
<div class='widget-content' id='Feed1_feedItemListDisplay'>
<span style='filter: alpha(25); opacity: 0.25;'>
<a href='http://planet.factorcode.org/feed.xml'>Loading...</a>
</span>
</div>
<div class='clear'></div>
</div><div class='widget LinkList' data-version='1' id='LinkList1'>
<h2>Links</h2>
<div class='widget-content'>
<ul>
<li><a href='http://twitter.com/slava_pestov'>@slava_pestov</a></li>
<li><a href='http://factorcode.org/slava/'>My home page</a></li>
<li><a href='http://factorcode.org/'>Factor programming language</a></li>
<li><a href='http://concatenative.org/'>Concatenative language wiki</a></li>
<li><a href='http://planet.factorcode.org/'>Planet Factor</a></li>
</ul>
<div class='clear'></div>
</div>
</div></div>
</div>
<!-- spacer for skins that want sidebar and main to be the same height-->
<div class='clear'>&#160;</div>
</div>
<!-- end content-wrapper -->
<div id='footer-wrapper'>
<div class='footer no-items section' id='footer'></div>
</div>
</div></div>
<!-- end outer-wrapper -->

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/940443484-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY5kKcBoDbgyIagcHd4lbuq8pJZSHg:1693932713870';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d17087850','//factor-language.blogspot.com/2008/06/','17087850');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '17087850', 'title': 'Factor: a practical stack language', 'url': 'http://factor-language.blogspot.com/2008/06/', 'canonicalUrl': 'http://factor-language.blogspot.com/2008/06/', 'homepageUrl': 'http://factor-language.blogspot.com/', 'searchUrl': 'http://factor-language.blogspot.com/search', 'canonicalHomepageUrl': 'http://factor-language.blogspot.com/', 'blogspotFaviconUrl': 'http://factor-language.blogspot.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en-US', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Factor: a practical stack language - Atom\x22 href\x3d\x22http://factor-language.blogspot.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Factor: a practical stack language - RSS\x22 href\x3d\x22http://factor-language.blogspot.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Factor: a practical stack language - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/17087850/posts/default\x22 /\x3e\n', 'meTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/591781cadcbb8744', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'archive', 'pageName': 'June 2008', 'pageTitle': 'Factor: a practical stack language: June 2008'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Factor: a practical stack language', 'description': '\x3ca href\x3d\x22http://factorcode.org/slava\x22\x3eSlava Pestov\x3c/a\x3e\x27s weblog, primarily about \x3ca href\x3d\x22http://factorcode.org\x22\x3eFactor\x3c/a\x3e.', 'url': 'http://factor-language.blogspot.com/2008/06/', 'type': 'feed', 'isSingleItem': false, 'isMultipleItems': true, 'isError': false, 'isPage': false, 'isPost': false, 'isHomepage': false, 'isArchive': true, 'isLabelSearch': false, 'archive': {'year': 2008, 'month': 6, 'rangeMessage': 'Showing posts from June, 2008'}}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/1333563935-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/3268905543-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_FeedView', new _WidgetInfo('Feed2', 'sidebar', document.getElementById('Feed2'), {'title': 'Recent Factor Commits', 'showItemDate': true, 'showItemAuthor': true, 'feedUrl': 'http://gitweb.factorcode.org/gitweb.cgi?p\x3dfactor.git;a\x3datom', 'numItemsShow': 5, 'loadingMsg': 'Loading...', 'openLinksInNewWindow': false, 'useFeedWidgetServ': 'true'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_FeedView', new _WidgetInfo('Feed1', 'sidebar', document.getElementById('Feed1'), {'title': 'Planet Factor', 'showItemDate': true, 'showItemAuthor': false, 'feedUrl': 'http://planet.factorcode.org/feed.xml', 'numItemsShow': 5, 'loadingMsg': 'Loading...', 'openLinksInNewWindow': false, 'useFeedWidgetServ': 'true'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LinkListView', new _WidgetInfo('LinkList1', 'sidebar', document.getElementById('LinkList1'), {}, 'displayModeFull'));
</script>
</body>
</html>